---
layout: post
title: Breakpad在进程中完成dump的流程描述
categories:
- C++
tags:
- Breakpad
- C++
- dump
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '23'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---

<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><font size="3"><span lang="EN-US"><font face="Times New Roman">Breakpad</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">在进程中完成</span><span lang="EN-US"><font face="Times New Roman">dump</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">的流程描述</span></font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US"><o:p><font face="Times New Roman" size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><font size="3"><span lang="EN-US"><font face="Times New Roman">ExceptionHandler</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">构造函数调用</span><span lang="EN-US"><font face="Times New Roman">Initialize</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">函数完成初始化</span><span lang="EN-US"><font face="Times New Roman">.</font></span></font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><font size="3"><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">当</span><span lang="EN-US"><font face="Times New Roman">pipe_name</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">不为空的时候</span><span lang="EN-US"><font face="Times New Roman">,</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">利用智能指针创建一个</span><span lang="EN-US"><font face="Times New Roman">CrashGenerationClient</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">对象</span><span lang="EN-US"><font face="Times New Roman">,</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">并注册后赋值给成员变量</span><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">crash_generation_client_.<o:p></o:p></span></font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">这是调用<span lang="EN-US">IsOutOfProcess</span>成员函数<span lang="EN-US">,</span>确定是否正常创建了<span lang="EN-US">CrashGenerationClient,</span>这里的注释说明<span lang="EN-US">, CrashGenerationClient</span>和<span lang="EN-US">CrashGenerationServer</span>的创建主要是为了一个进程外的<span lang="EN-US">dump,</span>也就是说<span lang="EN-US">,</span>在不影响原程序运行的情况下<span lang="EN-US">,</span>正常的<span lang="EN-US">dump,</span>这里解释了在原测试程序中为何不调用<span lang="EN-US">CrashGenerationServer</span>也可以正常<span lang="EN-US">dump,</span>因为当<span lang="EN-US">CrashGenerationClient</span>没有正常创建和注册的时候<span lang="EN-US">,</span>程序就开始一个进程内的<span lang="EN-US">dump,</span>也就是说<span lang="EN-US">,</span>原程序将没有办法正常运行的<span lang="EN-US">dump.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">因为这个简单的测试程序中调用的是五参数的构造函数构造</span><font size="3"><span lang="EN-US"><font face="Times New Roman">ExceptionHandler,</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">更没有开启</span><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">CrashGenerationServer,</span></font><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">所以这里走的是进程内<span lang="EN-US">dump</span>流程<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">关于<span lang="EN-US">ExceptionHandler</span>构造函数参数的主要信息在<span lang="EN-US">&lt;</span></span><font size="3"><span lang="EN-US"><font face="Times New Roman">Breakpad </font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">使用方法理解文档</span><span lang="EN-US"><font face="Times New Roman">&gt;.</font></span><span style="FONT-FAMILY: 宋体; mso-hansi-font-family: 'Times New Roman'; mso-ascii-font-family: 'Times New Roman'">中</span></font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">此时<span lang="EN-US">ExceptionHandler</span>自己创建线程来处理异常<span lang="EN-US">.</span>首先还创建了信标<span lang="EN-US">handler_start_semaphore_,handler_finish_semaphore_,</span>都设为无信号状态<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp;</span><o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">创建新线程用的是<span lang="EN-US">CreateThread</span>函数，新线程调用的函数名为<span lang="EN-US">ExceptionHandlerThreadMain</span>，参数为<span lang="EN-US">this</span>．<span lang="EN-US"><o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">此线程的作用是无限的等待<span lang="EN-US">handler_start_semaphore_</span>的<span lang="EN-US">Semaphore</span>信号，等到<span lang="EN-US">Semaphore</span>信号后，直接就调用<span lang="EN-US">WriteMinidumpWithException</span>函数，开始<span lang="EN-US">dump</span>．<span lang="EN-US">Dump</span>后打开<span lang="EN-US">handler_finish_semaphore_</span>的<span lang="EN-US">Semaphore</span>信号<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">在开启等待线程后<span lang="EN-US">, Initialize</span>函数继续进行<span lang="EN-US">,</span>并载入相关库文件<span lang="EN-US">,</span>初始化了两个函数指针成员变量<span lang="EN-US">,</span>并设置好<span lang="EN-US">dump</span>路径<span lang="EN-US">,<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">最后根据<span lang="EN-US">handler_types</span>标志位<span lang="EN-US">,</span>调用<span lang="EN-US">windows API</span>确定取得各种异常情况下调用的函数<span lang="EN-US">.</span>这些函数最后得到异常信息<span lang="EN-US">,</span>处理后再通过判断<span lang="EN-US">IsOutOfProcess()</span>调用<span lang="EN-US">WriteMinidumpOnHandlerThread()</span>开启<span lang="EN-US">handler_start_semaphore_</span>的<span lang="EN-US">semaphore</span>信号<span lang="EN-US">,</span>开始<span lang="EN-US">dump.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: blue">if</span> (<span style="COLOR: black">handler_types</span> &amp; <span style="COLOR: black">HANDLER_EXCEPTION</span>)<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: black">previous_filter_</span> = <span style="COLOR: black">SetUnhandledExceptionFilter</span>(<span style="COLOR: black">HandleException</span>);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: blue; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">#if</span><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"> <span style="COLOR: black">_MSC_VER</span> &gt;= 1400<span style="mso-spacerun: yes">&nbsp; </span><span style="COLOR: green">// MSVC 2005/8<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: blue">if</span> (<span style="COLOR: black">handler_types</span> &amp; <span style="COLOR: black">HANDLER_INVALID_PARAMETER</span>)<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: black">previous_iph_</span> = <span style="COLOR: black">_set_invalid_parameter_handler</span>(<span style="COLOR: black">HandleInvalidParameter</span>);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: blue; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">#endif</span><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-spacerun: yes">&nbsp; </span><span style="COLOR: green">// _MSC_VER &gt;= 1400<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: green; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-ALIGN: left; mso-layout-grid-align: none" align="left"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: blue">if</span> (<span style="COLOR: black">handler_types</span> &amp; <span style="COLOR: black">HANDLER_PURECALL</span>)<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: black">previous_pch_</span> = <span style="COLOR: black">_set_purecall_handler</span>(<span style="COLOR: black">HandlePureVirtualCall</span>);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">以上三个函数的含义分别是<span lang="EN-US"><o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">SetUnhandledExceptionFilter(HandleException)</span><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">确定出现没有控制的异常发生时调用的函数为<span lang="EN-US">HandleException.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">_set_invalid_parameter_handler(HandleInvalidParameter)</span><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">确定出现无效参数调用发生时调用的函数为<span lang="EN-US">HandleInvalidParameter.</span></span><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">_set_purecall_handler(HandlePureVirtualCall)</span><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">确定纯虚函数调用发生时调用的函数为<span lang="EN-US">HandlePureVirtualCall.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">在其定义的三个函数中<span lang="EN-US">,</span>流程基本一样<span lang="EN-US">,</span>都是先通过定义一个<span lang="EN-US" style="COLOR: black">AutoExceptionHandler</span><span style="COLOR: black">成员变量<span lang="EN-US">,</span>通过上述三个函数恢复上一个用户的异常控制函数<span lang="EN-US">,</span>以处理在此次异常处理中发生的异常<span lang="EN-US">.</span>然后通过一些数据处理<span lang="EN-US">,</span>再判断<span lang="EN-US">IsOutOfProcess(),</span>这里我没有用<span lang="EN-US">CrashGeneration</span>机制<span lang="EN-US">,</span>自然还是返回<span lang="EN-US">false,</span>此时这三个函数都是调用<span lang="EN-US">WriteMinidumpOnHandlerThread(),</span>开启<span lang="EN-US">handler_start_semaphore_</span>的<span lang="EN-US">semaphore</span>信号<span lang="EN-US">,</span>效果就是开始调用<span lang="EN-US">ExceptionHandlerThreadMain</span>线程开始<span lang="EN-US">dump.</span>接下来<span lang="EN-US">,</span>他们判断此次异常控制是否成功<span lang="EN-US">,</span>不成功就将交给上一层的异常处理函数处理<span lang="EN-US">.<o:p></o:p></span></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">这一步具体的实现上<span lang="EN-US">:<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">在<span lang="EN-US">HandleException()</span>函数中<span lang="EN-US">,</span>如同<span lang="EN-US">SHE</span>常过滤器要求的那样<span lang="EN-US">,</span>当成功时<span lang="EN-US">,</span>返回<span lang="EN-US">EXCEPTION_EXECUTE_HANDLER,</span>表示控制了异常<span lang="EN-US">,</span>不成功时<span lang="EN-US">,</span>此函数先判断是否有用户的上层异常过滤器函数<span lang="EN-US">,</span>有的话<span lang="EN-US">,</span>直接先利用它处理<span lang="EN-US">,</span>没有就返回<span lang="EN-US">EXCEPTION_CONTINUE_SEARCH,</span>告诉操作系统开始上一层异常处理的搜索<span lang="EN-US">.</span>这里可以参看结构化异常处理程序理解文档第<span lang="EN-US">25</span>章内容<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">在<span lang="EN-US">HandleInvalidParameter()</span>中<span lang="EN-US">,</span>成功就直接通过<span lang="EN-US">exit(0)</span>退出主线程了<span lang="EN-US">,</span>不成功就调用上一层此类异常函数处理<span lang="EN-US">.</span>当没有上一层此类异常函数<span lang="EN-US">,</span>并且在<span lang="EN-US">Debug</span>时<span lang="EN-US">,</span>其调用<span lang="EN-US">_invalid_parameter()</span>函数<span lang="EN-US">,</span>向编译器报告一个无效参数的信息<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">在<span lang="EN-US">HandlePureVirtualCall()</span>函数中<span lang="EN-US">,</span>之前加入了额外写入<span lang="EN-US">dump</span>文件的信息<span lang="EN-US">,</span>一个<span lang="EN-US">MDRawAssertionInfo</span>结构<span lang="EN-US">,type</span>被设为<span lang="EN-US">MD_ASSERTION_INFO_TYPE_PURE_VIRTUAL_CALL.</span>其他流程类似<span lang="EN-US">.<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes">以上基本就是不使用<span lang="EN-US">CrashGeneration</span>在进程中完成<span lang="EN-US">dump</span>的流程<span lang="EN-US"><o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><span lang="EN-US"><o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt"><span lang="EN-US" style="FONT-SIZE: 12pt; FONT-FAMILY: 新宋体; mso-font-kerning: 0pt; mso-hansi-font-family: 'Times New Roman'; mso-no-proof: yes"><o:p>&nbsp;</o:p></span></p>
<p>&nbsp;</p>
