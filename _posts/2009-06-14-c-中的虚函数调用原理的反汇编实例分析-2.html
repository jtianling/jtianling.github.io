---
layout: post
title: C++中的虚函数调用原理的反汇编实例分析(2)
categories:
- "汇编和反汇编"
tags:
- C++
- "虚函数"
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '15'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1>C++中的虚函数调用原理的反汇编实例分析(2) </h1>
<p style="text-align: right"><span style="color: #c0504d; text-decoration: underline;"><strong>write by <span style="font-family:宋体">九天雁翎</span>(JTianLing) -- www.jtianling.com</strong></span> </p>
<p>因为昨天的第一节中我其实感觉并没有太透彻的理解其原理，也对VC6的实现是否会继续抱有怀疑态度，所以今天特意用VS2005编译并分析了一下，只能说，从反汇编的角度来看都可以看出微软的进步实在是很大的，有钱嘛：）呵呵，也许Stanley B.Lippman的功劳不是白费的吧。速度上我是没有好好的去测试了，从逻辑上看，可读性都强了很多（呵呵，汇编代码要可读性干什么。。。。。） </p>
<p>为了可读性。。。。我个人就麻烦一点了，以后汇编代码也不是全黑出镜了。。。。我还是用gvim给大家上上色吧。。。。 </p>
<p>&nbsp;</p>
<h2>示例程序： </h2>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">class</span> <span style="color:#010001">CTestThisPointer </span></span></p>
<p><span style="font-family:新宋体">{ </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">public</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>):<span style="color:#010001">mi</span>(<span style="color:#010001">ai</span>) { } </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">virtual</span> <span style="color:blue">int</span> <span style="color:#010001">Add</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>) </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">mi</span> += <span style="color:#010001">ai</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;} </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">private</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">int</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">}; </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">int</span> <span style="color:#010001">main</span>() </span></p>
<p><span style="font-family:新宋体">{ </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span> <span style="color:#010001">loTest</span>(10); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span> *<span style="color:#010001">lp</span> = &amp;<span style="color:#010001">loTest</span>; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%d/n"</span>,<span style="color:#010001">lp</span>-&gt;<span style="color:#010001">Add</span>(5)); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%s/n"</span>,<span style="color:blue">typeid</span>(<span style="color:#010001">lp</span>).<span style="color:#010001">name</span>()); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span> 0; </span></p>
<p><span style="font-family:新宋体">}</span><span style="color:#a020f0; font-family:Courier New"> </span></p>
<p>和在第一节中的源代码是一样的，只是这次我用VS2005最大速度优化release编译 </p>
<p>&nbsp;</p>
<h2>反汇编： </h2>
<p>主函数： </p>
<p><span style="font-family:Courier New"><span style="color:#804040">&nbsp;1 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:blue">; int __cdecl main(int argc, const char **argv, const char *envp)</span><br /><span style="color:#804040">&nbsp;2 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">_main</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>proc</strong></span>&nbsp;<span style="color:seagreen"><strong>near</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; CODE XREF: __tmainCRTStartup+10A^Yp</span><br /><span style="color:#804040">&nbsp;3 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span><br /><span style="color:#804040">&nbsp;4 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">var_8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-8</span><br /><span style="color:#804040">&nbsp;5 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">var_4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-4</span><br /><span style="color:#804040">&nbsp;6 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">argc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">4</span><br /><span style="color:#804040">&nbsp;7 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">argv</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">8</span><br /><span style="color:#804040">&nbsp;8 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;<span style="color:teal">envp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">0Ch</span><br /><span style="color:#804040">&nbsp;9 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span><br /><span style="color:#804040">10 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>sub</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">此处为临时变量</span><span style="color:blue"><span style="font-family:Courier New">var_8,var_4</span><span style="font-family:宋体">预留空间，但是因为直接使用</span><span style="font-family:Courier New">esp</span><span style="font-family:宋体">，</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">11 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">所以我感觉后面的的堆栈有点混乱，比如后面的</span><span style="font-family:Courier New"><span style="color:blue">esp+10h,</span><br /><span style="color:#804040">12 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">这里有个有意思的优化在于</span><span style="color:blue"><span style="font-family:Courier New">5</span><span style="font-family:宋体">竟然是只有</span><span style="font-family:Courier New">2</span><span style="font-family:宋体">个字节的使用，</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">13 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">所以</span><span style="color:blue"><span style="font-family:Courier New">esp-8</span><span style="font-family:宋体">以后，</span><span style="font-family:Courier New">push esi(</span><span style="font-family:宋体">保存</span><span style="font-family:Courier New">esi)</span><span style="font-family:宋体">然后又</span><span style="font-family:Courier New">-4=0ch</span><span style="font-family:宋体">，然后</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">14 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">因为</span><span style="color:blue"><span style="font-family:Courier New">push 5(add</span><span style="font-family:宋体">参数）然后</span><span style="font-family:Courier New">-2=010h,</span><span style="font-family:宋体">所以以后的临时变量</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">15 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">不得不先</span><span style="color:blue"><span style="font-family:Courier New">+10h</span><span style="font-family:宋体">以获取正确的地址，看到下面的汇编代码</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">16 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">应该就好理解了</span><span style="font-family:Courier New"><br /><span style="color:#804040">17 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">;</span><br /><span style="color:#804040">18 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401013</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span><br /><span style="color:#804040">19 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401014</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:fuchsia">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">这是</span><span style="color:blue"><span style="font-family:Courier New">Add</span><span style="font-family:宋体">函数的参数了，这里是先</span><span style="font-family:Courier New">push</span><span style="font-family:宋体">参数，然后再正确为</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">20 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401014</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; CTestThisPointer</span></span><span style="font-family:宋体">赋值（从构造函数优化而来），再调用</span><span style="font-family:Courier New"><br /><span style="color:#804040">21 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401014</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; Add</span></span><span style="font-family:宋体">函数，中间断开了，但是从栈的走向还是可以看出</span><span style="font-family:Courier New"><br /><span style="color:#804040">22 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401014</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">此处实际是</span><span style="color:blue"><span style="font-family:Courier New">Add</span><span style="font-family:宋体">函数的参数</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">23 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401016</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>lea</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, [<span style="color:slateblue">esp</span><span style="color:fuchsia">+10h</span>+<span style="color:teal">var_8</span>] <span style="color:blue">; </span></span><span style="font-family:宋体">此处也是</span><span style="color:blue"><span style="font-family:Courier New">Add</span><span style="font-family:宋体">函数的参数，即</span><span style="font-family:Courier New">this</span><span style="font-family:宋体">指针了</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">24 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040101</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+10h</span>+<span style="color:teal">var_8</span>], <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>'<br /><span style="color:#804040">25 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401022</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+10h</span>+<span style="color:teal">var_4</span>], <span style="color:fuchsia">0Ah</span>&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">构造函数没有调用，直接优化为赋值操作</span><span style="font-family:Courier New"><br /><span style="color:#804040">26 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040102</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">ds</span>:<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>' <span style="color:blue">;</span><br /><span style="color:#804040">27 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040102</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">一个虚函数的调用还是解释</span><span style="color:blue"><span style="font-family:Courier New">call this</span><span style="font-family:宋体">所在的地址就好了</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">28 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esi</span>, <span style="color:slateblue">ds</span>:<span style="color:teal">__imp__printf</span><br /><span style="color:#804040">29 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401036</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br /><span style="color:#804040">30 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401037</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aD</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%d/n"</span><br /><span style="color:#804040">31 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040103</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br /><span style="color:#804040">32 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040103</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">此</span><span style="color:blue"><span style="font-family:Courier New">add esp,8</span><span style="font-family:宋体">为调整</span><span style="font-family:Courier New">printf</span><span style="font-family:宋体">函数的栈平衡使用</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">33 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401041</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">__type_info_root_node</span>&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">此处不明，可能需要多个</span><span style="color:blue"><span style="font-family:Courier New">RTTI</span><span style="font-family:宋体">对象才能知道</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">34 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401041</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">因为就命名上来推测，可能是维护了一个</span><span style="color:blue"><span style="font-family:Courier New">RTTI</span><span style="font-family:宋体">对象的链表</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">35 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401041</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">而因为元素只有一个，所以没有办法肯定了</span><span style="font-family:Courier New"><br /><span style="color:#804040">36 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401046</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestThisPointer</span>&nbsp;* `<span style="color:teal">RTTI</span><span style="color:seagreen"><strong>&nbsp;Type</strong></span>&nbsp;<span style="color:teal">Descriptor</span>' <span style="color:blue">; </span></span><span style="font-family:宋体">此处相当于构建一个</span><span style="color:blue"><span style="font-family:Courier New">type_info</span><span style="font-family:宋体">的类，当时由于优化，没有</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">37 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401046</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">使用栈来创建局部变量和使用构造函数等，直接将</span><span style="font-family:Courier New"><span style="color:blue">type_info</span><br /><span style="color:#804040">38 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401046</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">的虚表赋值给</span><span style="color:blue"><span style="font-family:Courier New">ecx</span><span style="font-family:宋体">了，</span><span style="font-family:Courier New">ecx</span><span style="font-family:宋体">在</span><span style="font-family:Courier New">thiscall</span><span style="font-family:宋体">调用约定中就是</span><span style="font-family:Courier New">this</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">39 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401046</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">指针传递的参数啊，下面就调用了此对象的</span><span style="color:blue"><span style="font-family:Courier New">name</span><span style="font-family:宋体">成员函数</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">40 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040104</span><span style="color:teal">B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">ds</span>:<span style="color:teal">type_info</span>::<span style="color:#804040"><strong>name</strong></span>(<span style="color:teal">__type_info_node</span>&nbsp;*)<br /><span style="color:#804040">41 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401051</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br /><span style="color:#804040">42 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401052</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%s/n"</span><br /><span style="color:#804040">43 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401057</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br /><span style="color:#804040">44 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401059</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">此</span><span style="color:blue"><span style="font-family:Courier New">add esp,8</span><span style="font-family:宋体">也为调整</span><span style="font-family:Courier New">printf</span><span style="font-family:宋体">函数的栈平衡使用</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">45 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040105</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>xor</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, <span style="color:slateblue">eax</span><br /><span style="color:#804040">46 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040105</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>pop</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esi</span><br /><span style="color:#804040">47 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040105</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">此处才退出函数，</span><span style="color:blue"><span style="font-family:Courier New">CTestThisPointer</span><span style="font-family:宋体">结束生命周期，用</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">48 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">0040105</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; add esp,8</span></span><span style="font-family:宋体">清空临时变量</span><span style="font-family:Courier New"><br /><span style="color:#804040">49 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401062</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>retn</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">对了，才注意到</span><span style="color:blue"><span style="font-family:Courier New">main</span><span style="font-family:宋体">函数遵循的也是</span><span style="font-family:Courier New">__cdecl</span><span style="font-family:宋体">调用约定。。。</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">50 </span>.<span style="color:teal">text</span>:<span style="color:fuchsia">00401062</span>&nbsp;<span style="color:teal">_main</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>endp</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">其实自然啦，因为</span><span style="color:blue"><span style="font-family:Courier New">main</span><span style="font-family:宋体">函数的参数个数也是不定的</span><span style="font-family:Courier New"> </span></span></p>
<p>&nbsp;</p>
<p><span style="color:blue"><span style="font-family:宋体">虚表：</span><span style="font-family:Courier New"> </span></span></p>
<p><span style="font-family:Courier New"><span style="color:#804040">1 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">RTTI</span>&nbsp;<span style="color:teal">Complete</span>&nbsp;<span style="color:teal">Object</span>&nbsp;<span style="color:teal">Locator</span>' <span style="color:blue">;</span><br /><span style="color:#804040">2 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">这就是</span><span style="color:blue"><span style="font-family:Courier New">CTestThisPointer</span><span style="font-family:宋体">的</span><span style="font-family:Courier New">RTTI</span><span style="font-family:宋体">信息</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">3 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">正好在虚表前，由编译器静态分配，但是动态获取</span><span style="font-family:Courier New"><br /><span style="color:#804040">4 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; this</span></span><span style="font-family:宋体">指针的指向还是</span><span style="color:blue"><span style="font-family:Courier New">vtbl</span><span style="font-family:宋体">的第一个虚函数，此例中</span></span><span style="font-family:Courier New"><br /><span style="color:#804040">5 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">即为</span><span style="font-family:Courier New"><span style="color:blue">Add</span><br /><span style="color:#804040">6 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402118</span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>' <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestThisPointer__Add</span><br /><span style="color:#804040">7 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402118</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; DATA XREF: _main+A^Xo</span><br /><span style="color:#804040">8 </span>.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402118</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; _main+1A^Xr </span></span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">而虚表的前4个字节就是一个指针，指向了表示正确类型的type_info类的子类。</span><span style="color:blue; font-family:Courier New"> </span></p>
<p><span style="color:blue"><span style="font-family:宋体">到这里，一切就慢慢符合《</span><span style="font-family:Courier New">inside C++ Object</span><span style="font-family:宋体">》中描述的虚表了，呵呵，有了</span><span style="font-family:Courier New">lippman,</span><span style="font-family:宋体">微软总算走上正轨了，慢慢的。。。充满技术性天才的可怜</span><span style="font-family:Courier New">borland</span><span style="font-family:宋体">也走入了末途。</span><span style="font-family:Courier New"> </span></span></p>
<p>&nbsp;</p>
<h2>继续，例2： </h2>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p><span style="font-family:新宋体"><span style="color:blue">#include</span> <span style="color:#a31515"></span></span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">class</span> <span style="color:#010001">CTestThisPointer </span></span></p>
<p><span style="font-family:新宋体">{ </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">public</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>):<span style="color:#010001">mi</span>(<span style="color:#010001">ai</span>) { } </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">virtual</span> <span style="color:blue">int</span> <span style="color:#010001">Add</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>) </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">mi</span> += <span style="color:#010001">ai</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;} </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green">// 纯废的析构函数 </span></span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">virtual</span> ~<span style="color:#010001">CTestThisPointer</span>() { <span style="color:#010001">mi</span> = 0;} </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">private</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">int</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">}; </span></p>
<p>&nbsp;</p>
<p><span style="color:green; font-family:新宋体">// 无继承关系，仅为分析RTTI </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">class</span> <span style="color:#010001">CTestBase </span></span></p>
<p><span style="font-family:新宋体">{ </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">public</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestBase</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>):<span style="color:#010001">mi</span>(<span style="color:#010001">ai</span>) { } </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">virtual</span> <span style="color:blue">int</span> <span style="color:#010001">Add</span>(<span style="color:blue">int</span> <span style="color:#010001">ai</span>) </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">mi</span> += <span style="color:#010001">ai</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">mi</span> += <span style="color:#010001">ai</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;} </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green">// 纯废的析构函数 </span></span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;~<span style="color:#010001">CTestBase</span>() { <span style="color:#010001">mi</span> = 0;} </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">private</span>: </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">int</span> <span style="color:#010001">mi</span>; </span></p>
<p><span style="font-family:新宋体">}; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">int</span> <span style="color:#010001">main</span>() </span></p>
<p><span style="font-family:新宋体">{ </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span> <span style="color:#010001">loTest</span>(10); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestThisPointer</span> *<span style="color:#010001">lp</span> = &amp;<span style="color:#010001">loTest</span>; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%d/n"</span>,<span style="color:#010001">lp</span>-&gt;<span style="color:#010001">Add</span>(5)); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%s/n"</span>,<span style="color:blue">typeid</span>(<span style="color:#010001">lp</span>).<span style="color:#010001">name</span>()); </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestBase</span> <span style="color:#010001">loTestBase</span>(20); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">CTestBase</span>* <span style="color:#010001">lpTestBase</span> = &amp;<span style="color:#010001">loTestBase</span>; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%s/n"</span>,<span style="color:blue">typeid</span>(<span style="color:#010001">CTestBase</span>).<span style="color:#010001">name</span>()); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%s/n"</span>,<span style="color:blue">typeid</span>(<span style="color:#010001">loTestBase</span>).<span style="color:#010001">name</span>()); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#010001">printf</span>(<span style="color:#a31515">"%s/n"</span>,<span style="color:blue">typeid</span>(<span style="color:#010001">lpTestBase</span>).<span style="color:#010001">name</span>()); </span></p>
<p><span style="font-family:新宋体">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue">return</span> 0; </span></p>
<p><span style="font-family:新宋体">}</span><span style="color:blue; font-family:Courier New"> </span></p>
<p>&nbsp;</p>
<h2>反汇编代码： </h2>
<p>不重复注释重复内容 </p>
<p>主程序： </p>
<p><span style="font-family:Courier New">.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:blue">; int __cdecl main(int argc, const char **argv, const char *envp)</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">_main</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>proc</strong></span>&nbsp;<span style="color:seagreen"><strong>near</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; CODE XREF: __tmainCRTStartup+10A^Yp</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_1C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-1Ch</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_18</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-18h</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_14</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-14h</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-10h</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-0Ch</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">var_4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;<span style="color:fuchsia">-4</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">argc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">4</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">argv</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;<span style="color:teal">envp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span style="color:seagreen"><strong>dword</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;&nbsp;<span style="color:fuchsia">0Ch</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:fuchsia">0FFFFFFFFh</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401072</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">loc_401A50</span>&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">因为程序足够大了。。。。</span><span style="color:blue"><span style="font-family:Courier New">MS</span><span style="font-family:宋体">自动的加入了</span><span style="font-family:Courier New">SEH</span><span style="font-family:宋体">异常处理</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401077</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, <span style="color:teal">large</span>&nbsp;<span style="color:slateblue">fs</span>:<span style="color:fuchsia">0</span>&nbsp;<span style="color:blue">; SEH</span></span><span style="font-family:宋体">的</span><span style="color:blue"><span style="font-family:Courier New">TEB(thread Environment Block)</span><span style="font-family:宋体">总是在</span><span style="font-family:Courier New">FS:0</span><span style="font-family:宋体">上</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040107D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040107</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>sub</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">10h</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401081</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401082</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">edi</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401083</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, <span style="color:teal">__security_cookie</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401088</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>xor</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, <span style="color:slateblue">esp</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040108</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040108</span><span style="color:teal">B</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>lea</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_C</span>]<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040108</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:teal">large</span>&nbsp;<span style="color:slateblue">fs</span>:<span style="color:fuchsia">0</span>, <span style="color:slateblue">eax</span>&nbsp;<span style="color:blue">; </span></span><span style="font-family:宋体">之前的代码都是在初始化</span><span style="color:blue"><span style="font-family:Courier New">TEB</span><span style="font-family:宋体">结构。。。。。。。</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_1C</span>], <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040109D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_18</span>], <span style="color:fuchsia">0Ah</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">A5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:fuchsia">5</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">A7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>lea</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, [<span style="color:slateblue">esp</span><span style="color:fuchsia">+2Ch</span>+<span style="color:teal">var_1C</span>]<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">AB</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+2Ch</span>+<span style="color:teal">var_4</span>], <span style="color:fuchsia">0</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">B3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">ds</span>:<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">B9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esi</span>, <span style="color:slateblue">ds</span>:<span style="color:teal">__imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">BF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">C0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aD</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%d/n"</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">C5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">C7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">edi</span>, <span style="color:slateblue">ds</span>:<span style="color:teal">type_info</span>::<span style="color:#804040"><strong>name</strong></span>(<span style="color:teal">__type_info_node</span>&nbsp;*)<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">CD</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010D0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">__type_info_root_node</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010D5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestThisPointer</span>&nbsp;* `<span style="color:teal">RTTI</span><span style="color:seagreen"><strong>&nbsp;Type</strong></span>&nbsp;<span style="color:teal">Descriptor</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010D</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">edi</span>&nbsp;<span style="color:blue">; type_info::name(__type_info_node *)</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010D</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010D</span><span style="color:teal">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%s/n"</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">E2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">E4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">E7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_14</span>], <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestBase</span>::`<span style="color:teal">vftable</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">EF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_10</span>], <span style="color:fuchsia">14h</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">F7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">__type_info_root_node</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">004010</span><span style="color:teal">FC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestBase</span>&nbsp;`<span style="color:teal">RTTI</span><span style="color:seagreen"><strong>&nbsp;Type</strong></span>&nbsp;<span style="color:teal">Descriptor</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401101</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:seagreen"><strong>byte</strong></span>&nbsp;<span style="color:seagreen"><strong>ptr</strong></span>&nbsp;[<span style="color:slateblue">esp</span><span style="color:fuchsia">+2Ch</span>+<span style="color:teal">var_4</span>], <span style="color:fuchsia">1</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401106</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">edi</span>&nbsp;<span style="color:blue">; type_info::name(__type_info_node *)</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401108</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401109</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%s/n"</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040110</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401113</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">__type_info_root_node</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401118</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestBase</span>&nbsp;`<span style="color:teal">RTTI</span><span style="color:seagreen"><strong>&nbsp;Type</strong></span>&nbsp;<span style="color:teal">Descriptor</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040111D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">edi</span>&nbsp;<span style="color:blue">; type_info::name(__type_info_node *)</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040111</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%s/n"</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401127</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040112</span><span style="color:teal">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">__type_info_root_node</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040112</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, <span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestBase</span>&nbsp;* `<span style="color:teal">RTTI</span><span style="color:seagreen"><strong>&nbsp;Type</strong></span>&nbsp;<span style="color:teal">Descriptor</span>'<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">edi</span>&nbsp;<span style="color:blue">; type_info::name(__type_info_node *)</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401136</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401137</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>push</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">aS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; "%s/n"</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040113</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>call</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:slateblue">esi</span>&nbsp;<span style="color:blue">; __imp__printf</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040113</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">8</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401141</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>xor</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">eax</span>, <span style="color:slateblue">eax</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401143</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span>, [<span style="color:slateblue">esp</span><span style="color:fuchsia">+28h</span>+<span style="color:teal">var_C</span>]<br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401147</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>mov</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:teal">large</span>&nbsp;<span style="color:slateblue">fs</span>:<span style="color:fuchsia">0</span>, <span style="color:slateblue">ecx</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040114</span><span style="color:teal">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>pop</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">ecx</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">0040114</span><span style="color:teal">F</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>pop</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">edi</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>pop</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esi</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401151</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>add</strong></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:slateblue">esp</span>, <span style="color:fuchsia">1Ch</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401154</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>retn</strong></span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401154</span>&nbsp;<span style="color:teal">_main</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>endp</strong></span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401154</span><br />.<span style="color:teal">text</span>:<span style="color:fuchsia">00401154</span>&nbsp;<span style="color:blue">; ---------------------------------------------------------------------------</span></span> </p>
<p>贴出来仅仅是为了完整性，其实已经没有什么新意了，无非就是多一些，唯一有价值提起的就是SEH机制的加入，这又是另外一个话题了，在此不详述了，可以查阅相关书籍，推荐的有《windows核心编程》和《加密与解密》相关章节，虽然内容都并不是很多。 </p>
<p>虚表。。。这才是符合主题的部分： </p>
<p><span style="font-family:Courier New">.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402124</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">RTTI</span>&nbsp;<span style="color:teal">Complete</span>&nbsp;<span style="color:teal">Object</span>&nbsp;<span style="color:teal">Locator</span>'<br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402128</span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestThisPointer</span>::`<span style="color:teal">vftable</span>' <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestThisPointer__Add</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402128</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; DATA XREF: CTestThisPointer___CTestThisPointer^Xo</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402128</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; CTestThisPointer___scalar_deleting_destructor_+8^Xo ...</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">0040212</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestThisPointer___scalar_deleting_destructor_</span>&nbsp;<span style="color:blue">;</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">0040212</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">哈雷卤鸭。。。。。好吃吗？</span><span style="color:blue"><span style="font-family:Courier New">-_-!</span><span style="font-family:宋体">果然虚表果然扩张了，</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">0040212</span><span style="color:teal">C</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">顺序排列的函数分别是</span><span style="color:blue"><span style="font-family:Courier New">Add,</span><span style="font-family:宋体">和</span><span style="font-family:Courier New">destructor</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestBase</span>::`<span style="color:teal">RTTI</span>&nbsp;<span style="color:teal">Complete</span>&nbsp;<span style="color:teal">Object</span>&nbsp;<span style="color:teal">Locator</span>'<br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;<span style="color:teal">const</span>&nbsp;<span style="color:teal">CTestBase</span>::`<span style="color:teal">vftable</span>' <span style="color:#804040"><strong>dd</strong></span>&nbsp;<span style="color:seagreen"><strong>offset</strong></span>&nbsp;<span style="color:teal">CTestBase__Add</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; DATA XREF: CTestBase___CTestBase^Xo</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; _main+77^Xo</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">;</span><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; </span></span><span style="font-family:宋体">此处也可以看出来，在虚表前的一个</span><span style="color:blue"><span style="font-family:Courier New">4</span><span style="font-family:宋体">字节结构，的确是</span></span><span style="font-family:Courier New"><br />.<span style="color:teal">rdata</span>:<span style="color:fuchsia">00402134</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue">; RTTI</span></span><span style="font-family:宋体">使用的。。。。只是</span><span style="color:blue"><span style="font-family:Courier New">this</span><span style="font-family:宋体">指针直接指向的是虚表</span></span><span style="color:#a020f0; font-family:Courier New"> </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>以下是<span style="color:#010001; font-family:新宋体">__type_info_node的</span>链表。。。。。。。。。,没有上色了。。。 </p>
<p>.rdata:00402274 dd offset CTestBase::`RTTI Class Hierarchy Descriptor' </p>
<p>.rdata:00402278 const CTestThisPointer::`RTTI Complete Object Locator' db 0 </p>
<p>.rdata:00402278 ; DATA XREF: .rdata:00402124o </p>
<p>.rdata:00402279 db 0 </p>
<p>.rdata:0040227A db 0 </p>
<p>.rdata:0040227B db 0 </p>
<p>.rdata:0040227C db 0 </p>
<p>.rdata:0040227D db 0 </p>
<p>.rdata:0040227E db 0 </p>
<p>.rdata:0040227F db 0 </p>
<p>.rdata:00402280 db 0 </p>
<p>.rdata:00402281 db 0 </p>
<p>.rdata:00402282 db 0 </p>
<p>.rdata:00402283 db 0 </p>
<p>.rdata:00402284 dd offset CTestThisPointer `RTTI Type Descriptor' </p>
<p>.rdata:00402288 dd offset CTestThisPointer::`RTTI Class Hierarchy Descriptor' </p>
<p>.rdata:0040228C CTestThisPointer::`RTTI Class Hierarchy Descriptor' db 0 </p>
<p>.rdata:0040228C ; DATA XREF: .rdata:00402288o </p>
<p>.rdata:0040228C ; .rdata:004022BCo </p>
<p>.rdata:0040228D db 0 </p>
<p>.rdata:0040228E db 0 </p>
<p>.rdata:0040228F db 0 </p>
<p>.rdata:00402290 db 0 </p>
<p>.rdata:00402291 db 0 </p>
<p>.rdata:00402292 db 0 </p>
<p>.rdata:00402293 db 0 </p>
<p>.rdata:00402294 db 1 </p>
<p>.rdata:00402295 db 0 </p>
<p>.rdata:00402296 db 0 </p>
<p>.rdata:00402297 db 0 </p>
<p>.rdata:00402298 dd offset CTestThisPointer::`RTTI Base Class Array' </p>
<p>.rdata:0040229C CTestThisPointer::`RTTI Base Class Array' dd offset CTestThisPointer::`RTTI Base Class Descriptor at (0,-1,0,64)' </p>
<p>.rdata:0040229C ; DATA XREF: .rdata:00402298o </p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color:#010001; font-family:新宋体">__type_info_node的</span><span style="color:blue"><span style="font-family:宋体">链表。。。。可以在</span><span style="font-family:Courier New">VS2005</span><span style="font-family:宋体">的头文件中找到依据：</span><span style="font-family:Courier New"> </span></span></p>
<p><span style="font-family:新宋体"><span style="color:blue">struct</span> <span style="color:#010001">__type_info_node</span> { </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">void</span> *<span style="color:#010001">memPtr</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">__type_info_node</span>* <span style="color:#010001">next</span>; </span></p>
<p><span style="font-family:新宋体">}; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">extern</span> <span style="color:#010001">__type_info_node</span> <span style="color:#010001">__type_info_root_node</span>; </span></p>
<p><span style="font-family:新宋体">呵呵，不就是这个吗？ </span></p>
<p>&nbsp;</p>
<p>最后，在VS2005的头文件中可以看到type_info类的声明和反汇编代码上看到的完全一致。。。。 </p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体"><span style="color:blue">class</span> <span style="color:#010001">type_info</span> { </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">public</span>: </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">virtual</span> ~<span style="color:#010001">type_info</span>(); </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">bool</span> <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:blue">operator</span>==(<span style="color:blue">const</span> <span style="color:#010001">type_info</span>&amp; <span style="color:#010001">rhs</span>) <span style="color:blue">const</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">bool</span> <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:blue">operator</span>!=(<span style="color:blue">const</span> <span style="color:#010001">type_info</span>&amp; <span style="color:#010001">rhs</span>) <span style="color:blue">const</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">int</span> <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:#010001">before</span>(<span style="color:blue">const</span> <span style="color:#010001">type_info</span>&amp; <span style="color:#010001">rhs</span>) <span style="color:blue">const</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">const</span> <span style="color:blue">char</span>* <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:#010001">name</span>(<span style="color:#010001">__type_info_node</span>* <span style="color:#010001">__ptype_info_node</span> = &amp;<span style="color:#010001">__type_info_root_node</span>) <span style="color:blue">const</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">const</span> <span style="color:blue">char</span>* <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:#010001">raw_name</span>() <span style="color:blue">const</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">private</span>: </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">void</span> *<span style="color:#010001">_m_data</span>; </span></p>
<p><span style="font-family:新宋体"><span style="color:blue">char</span> <span style="color:#010001">_m_d_name</span>[1]; </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:#010001">type_info</span>(<span style="color:blue">const</span> <span style="color:#010001">type_info</span>&amp; <span style="color:#010001">rhs</span>); </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">type_info</span>&amp; <span style="color:#010001">__CLR_OR_THIS_CALL</span> <span style="color:blue">operator</span>=(<span style="color:blue">const</span> <span style="color:#010001">type_info</span>&amp; <span style="color:#010001">rhs</span>); </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">static</span> <span style="color:blue">const</span> <span style="color:blue">char</span> *<span style="color:#010001">__CLRCALL_OR_CDECL</span> <span style="color:#010001">_Name_base</span>(<span style="color:blue">const</span> <span style="color:#010001">type_info</span> *,<span style="color:#010001">__type_info_node</span>* <span style="color:#010001">__ptype_info_node</span>); </span></p>
<p><span style="font-family:新宋体"><span style="color:#010001">_CRTIMP_PURE</span> <span style="color:blue">static</span> <span style="color:blue">void</span> <span style="color:#010001">__CLRCALL_OR_CDECL</span> <span style="color:#010001">_Type_info_dtor</span>(<span style="color:#010001">type_info</span> *); </span></p>
<p><span style="font-family:新宋体">}; </span></p>
<p>&nbsp;</p>
<p><span style="font-family:新宋体">至此。。。。C++中虚函数调用的机制差不多可以知道了。。。。顺面还搞定了RTTI....加上继承不过就是换个虚表的问题了。虚表的结构又不会变。。。。。不深究了，生命是有限的。。。。。 </span></p>
<p>&nbsp;</p>
<p style="text-align: right"><span style="color: #c0504d; text-decoration: underline;"><strong>write by <span style="font-family:宋体">九天雁翎</span>(JTianLing) -- www.jtianling.com</strong></span> </p>
