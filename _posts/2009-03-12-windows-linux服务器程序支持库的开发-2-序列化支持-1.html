---
layout: post
title: windows/linux服务器程序支持库的开发（2）--序列化支持(1)
categories:
- "网络技术"
tags:
- "序列化"
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '10'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1 style="margin: 24pt 0cm 0pt;"><span lang="EN-US"><a href="http://www.jtianling.com/archive/2009/03/01/3947195.aspx" target="_blank"><span style="color: #365f91; text-decoration: none; mso-themecolor: accent1; mso-themeshade: 191; text-underline: none;"><span style="font-family: Cambria;">windows/linux</span></span><span style="color: #365f91; font-family: 宋体; text-decoration: none; mso-themecolor: accent1; mso-themeshade: 191; text-underline: none; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;" lang="EN-US"><span lang="EN-US">服务器程序支持库的开发</span></span></a></span><span style="color: #365f91;"><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">（</span><span lang="EN-US"><span style="font-family: Cambria;">2</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">）</span><span lang="EN-US"><span style="font-family: Cambria;">--</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">序列化支持</span><span lang="EN-US"><span style="font-family: Cambria;">(1)</span></span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps;">九天雁翎</span><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><strong><span style="text-decoration: underline;"><span style="color: #c0504d; letter-spacing: 0.25pt; font-variant: small-caps; mso-themecolor: accent2; mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US"><span style="font-size: small;">讨论新闻组及文件</span></span></span></strong></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-family: 新宋体; mso-fareast-language: ZH-CN;"><span style="font-size: small;">没有工作前，不知道序列化的作用。。。。虽然那时候学习《<span lang="EN-US">Programming with MFC</span>》的时候，也知道<span lang="EN-US">CArchive</span>，<span lang="EN-US">CObject</span>等东西，但是没有太意识到其作用。但是，如前所述，我工作的第一件事情，就是了解公司的序列化类。从当时的一无所知，到现在也慢慢理解了一些序列化的作用了。说起来，自从工作以来因为当时做文件系统后后来的程序补丁，我应经在公司的序列化类以外额外实现了两个独立的序列化类了，分别是文件序列化和内存序列化。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-family: 新宋体; mso-fareast-language: ZH-CN;"><span style="font-size: small;">这里也顺面讲讲序列化吧，虽然不算太难，也不算太复杂，但是这样越是基础的东西越是支持着程序：）没有还真不行。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">序列化的作用包括，实现操作系统，硬件平台无关的数据保存和传输。从网络传输角度来讲解决诸如大头，小头等问题。目前我自己的感受还有，对于保存数据和读取数据使用同一套接口，简化了数据结构的管理，方便使用。虽然，</span><span style="color: red; font-family: 新宋体; mso-fareast-language: ZH-CN;">序列化的作用一般是用来做永久保存的</span><span style="font-family: 新宋体; mso-fareast-language: ZH-CN;">，在《深入浅出<span lang="EN-US">MFC</span>》中，侯捷就将其中的序列化技术讲解称为&ldquo;<span lang="EN-US">VC++</span>六大关键技术&rdquo;，事实上，序列化的作用不仅仅如此，比如我以前不就写过一个内存序列化类吧：）公司还有一个网络序列化类，即便在<span lang="EN-US">MFC</span>中，也有可以序列化的<span lang="EN-US">CMemFile</span>，事实上，<span style="color: red;">序列化还是一种二进制的交流方式。</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">：）</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">最典型的网络程序，就更好理解了，网络上交流的其实都是二进制的数据，从一端到另外一端，大家要有统一的格式支持才能和谐</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">-_-</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">！不仅仅是字符串的编码需要一致，字节的顺序需要一致，每个位置是什么值自然也需要一一指定好，一般而言，对于网络程序，在我们公司，对于序列化成一个包，我们叫打包，从一个网络包反序列化（似乎也有人叫串行化），我们叫解包。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这种二进制交流的方式不仅限于网络程序，任何程序间的交流都有可能用到，我碰到另外一个典型情况是一个</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">脚本希望将一些数据经过一段</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序，然后再放到另外一段</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">脚本中去，这时当然可以通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">将所有的数据都一个一个转成</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">变量保存下来然后传出去，由</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序运行时保存，然后再通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">一一转成</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的变量，这样做有很多不好的地方，其一是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">脚本间传递的数据对于</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序来说不透明，任何改变都需要</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序进行相应的更改，另外是每个变量都通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">去转换效率不高。其实这里就可以利用序列化成二进制数据来传输，其上两个缺点都会消失。顺面提一下，在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中可以通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">struct</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">库的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">pack,unpack</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">函数进行简单数据的序列化，通过</span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">marshal</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">库来进行复杂对象的序列化（可是这个库好像已经不被推荐，但是我当时在实际工作中使用的就是这个），有更先进的</span></span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">pickle(</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">有更快的</span></span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">C</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">语言版本</span></span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">cPickle)</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">，</span></span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">shelve</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">可用。从这点来看，又会感叹</span></span><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US"><span style="font-family: Calibri;">Python</span></span></span><span class="pre"><span style="line-height: 115%; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;">的库实在是太多，往往不是没有你想要的库，而是由于库太多，你不知道哪个好用</span></span><span style="font-family: Calibri;"><span class="pre"><span style="line-height: 115%; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt;" lang="EN-US">-_-!</span></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">九天雁翎</span></span></strong><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
