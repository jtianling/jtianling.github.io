---
layout: post
title: Google C++ Style中允许使用的Boost库(1)
categories:
- C++
tags:
- Boost
- C++
- Google
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '97'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---

<div style="margin-top: 6px; margin-right: 6px; margin-bottom: 6px; margin-left: 6px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-family: SimSun, 宋体, 'MS Song', serif; font-size: 10pt; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); min-height: 1100px; counter-reset: __goog_page__ 0; line-height: 1.5; ">
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; ">
<p dir="ltr" id="fins" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; text-align: right; "><a href="http://blog.jtianling.com/"><span style="vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#000099;"><u><strong><span style="font-size:16px;">write by 九天雁翎(JTianLing) -- blog.jtianling.com</span></strong></u></span></span></span></a><a href="http://www.jtianling.com"></a></p>
<p dir="ltr" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; text-align: right; "><a href="http://t.sina.com.cn/jtianling"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ee;"><u><strong><span style="font-size:16px;">新浪微博</span></strong></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ff;"><strong><span style="font-size:16px;">&nbsp;--&nbsp;</span></strong></span></span></span><a href="http://groups.google.com/group/jiutianfile"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ee;"><u><strong><span style="font-size:16px;">讨论新闻组</span></strong></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ff;"><span style="font-size:16px;">&nbsp;--&nbsp;</span></span></span></span><a href="http://code.google.com/p/jtianling/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ee;"><u><span style="font-size:16px;">代码库</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ff;"><span style="font-size:16px;">&nbsp;--&nbsp;</span></span></span></span><a href="http://www.douban.com/people/JTianLing/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#0000ee;"><u><span style="font-size:16px;">豆瓣</span></u></span></span></span></a></p>
<p><span style="font-size:16px;"><br /></span><br />
<h2 dir="ltr" style="font-size: 14pt; "><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><strong><span style="font-size:24px;">前言</span></strong></span></span></span></h2>
<p><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">作为系列的第一篇，如同往常一样唠叨几句吧，好久不写这种单纯语言相关的（特别是C++）文章了，因为慢慢觉得这些东西自己学学就OK，实际写出来的价值有限，因为思想少，技巧/知识多。因为前段时间做了半年多的Object C和JAVA了，并且C++ 0x标准就要出来了，语言改变还挺大，趁这个节骨眼，顺便再回头学习/总结一些我感兴趣的C++知识吧，不过应该持续时间不会太长，这个系列也不会太长，因为语言已经不是我关注的重点~~~~</span></span></span></span><span style="font-size:16px;"><br /><a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Google的C++ Style Guide</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">是我自己写东西的时候遵循的C++代码风格规范，前段时间看到李开复说他才发现Google的C++规范已经公开了，说这是世界上最好的C++规范，我感到很惊讶，因为N年前这个规范已经就公开了-_-!事实上，Google的 C++ Style Guide远不仅是一个传统意义上的代码书写风格指导，对于C++的方方面面做出了Google的解释和使用建议，包括每个规则给出时，较为详细的讲了这个规则好的一面和不好的一面，最最激进的规则甚至有禁用C++的异常，以及除了Google规范的Interface作为基类外，禁用多重继承，在绝大部分情况下禁用默认参数等内容。在很大程度上，Google是想把C++打造成效率高的JAVA来使用~~~~</span></span></span></span><span style="font-size:16px;"><br /><a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Google的C++ Style Guide</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">有关于</span></span></span></span><a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Boost"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Boost的一节</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">，允许使用的Boost库如下：</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/utility/call_traits.htm"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Call Traits</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/call_traits.hpp</span></span></span></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/utility/compressed_pair.htm"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Compressed Pair</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/compressed_pair.hpp</span></span></span></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/ptr_container/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Pointer Container</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/ptr_container except serialization and wrappers for containers not in the C++03 standard (ptr_circular_buffer.hpp and ptr_unordered*)</span></span></span></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/array/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Array</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/array.hpp</span></span></span></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/graph/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">The Boost Graph Library (BGL)</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/graph, except serialization (adj_list_serialize.hpp) and parallel/distributed algorithms and data structures (boost/graph/parallel/* andboost/graph/distributed/*).</span></span></span></span><span style="font-size:16px;"><br /><a href="http://www.boost.org/libs/property_map/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Property Map</span></u></span></span></span></a></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/property_map, except parallel/distributed property maps (boost/property_map/parallel/*).</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">The part of&nbsp;</span></span></span></span><a href="http://www.boost.org/libs/iterator/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Iterator</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;that deals with defining iterators: boost/iterator/iterator_adaptor.hpp, boost/iterator/iterator_facade.hpp, and boost/function_output_iterator.hpp</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-size:16px;"><br /></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">对此我感到比较惊讶，除了Array没啥好疑问的以外，我发现一些的确很好用的Boost库Google并不允许使用，比如</span></span></span></span><a href="http://www.jtianling.com/archive/2010/04/21/5509451.aspx"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">boost::bind</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">,&nbsp;</span></span></span></span><a href="http://www.jtianling.com/archive/2009/05/28/4219043.aspx"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">boost::function</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">,&nbsp;</span></span></span></span><a href="http://www.jtianling.com/archive/2009/05/22/4205134.aspx"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">boost::lambda&nbsp;</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">等，这个我不理解~~~~而Google提及的几个Boost库，除了Array很简单实用，BGL是一个数据结构和算法的扩充库，以前没有接触不奇怪外，其他的东西我发现自己竟然没有太接触过，作为自认为C++学习已经接近语言律师的我情何以堪-_-!~~~~~</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-size:16px;"><br /></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">因为很多时候，一个Boost库就代表着一个C++的缺陷的补救，因为即使最后不用Boost库，了解一下对于怎么正确的使用C++还是有很大帮助的。特作此系列。</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">1.</span></span></span></span><a href="http://www.boost.org/libs/utility/call_traits.htm"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Call Traits</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/call_traits.hpp</span></span></span></span><span style="font-size:16px;"><br /></span><span style="font-size:16px;"><br />先谈谈什么是Traits，BS的解释如下：</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><span style="color:#666666;"><em><span style="font-size:16px;">Think of a trait as a small object whose main purpose is to carry information used by another object or algorithm to determine &quot;policy&quot; or &quot;implementation details&quot;. - Bjarne Stroustrup</span></em></span><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">可以参考<a href="http://accu.org/index.php/journals/442" id="z4og" title="这里">这里</a>。所谓Call Traits就是调用时需要的Traits。&nbsp;</span><span style="font-size:16px;"><a href="http://boost.ez2learn.com/libs/utility/call_traits.htm" id="efxj" title="Call Traits中文文档">Call Traits中文文档</a>看下基本就明白啥意思了。我感觉最大的作用是在写模版类/模版函数传递参数时，保证没有“引用的引用”的情况发生，并且总以最高效的形式传递参数。所谓的最高效形式的规则类似JAVA，（仅仅是类似）即原生的类型就使用传值方式，对象就采用传引用方式。这里有个<a href="http://blog.csdn.net/whererush/article/details/1331031" id="gy:p" title="中文的例子">中文的例子</a>。</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">正常情况下，一个函数在C++中要么以传值方式传递参数，要么以传引用的方式传递，没法两者兼得：</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">template &lt;class T&gt;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">class TestClass {</span></div>
<p><span style="font-size:16px;">public:<br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; TestClass(T value) {</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; }</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; TestClass(const T&amp; value) {</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; ">&nbsp;&nbsp;</div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; T value_;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">};</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">在使用时会报错：</span></div>
</div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">error C2668: 'TestClass&lt;T&gt;::TestClass' : ambiguous call to overloaded function<br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">因为C++的函数重载规则并没有规定在这种情况下会调用哪一个函数，导致二义性。</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">使用Call_Traits的<span style="font-family:'times new roman';"><span style="font-size:16px;">param_type作为参数类型时，以下例子：</span></span></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">int g_i = 0;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">class PrintClass {</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">public:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; PrintClass() {</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; &nbsp; printf(&quot;PrintClass created&quot;);</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; &nbsp; ++g_i;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">};</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">template &lt;class T&gt;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">class TestClass {</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">public:</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; TestClass(typename boost::call_traits&lt;T&gt;::param_type value) : value_(value){</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; T value_;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">};</span></div>
<p><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; TestClass&lt;int&gt; test(10);</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; PrintClass printClass;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; TestClass&lt;PrintClass&gt; testPrintClass(printClass);</span></div>
<p><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-family:'times new roman';"><span style="font-size:16px;">g_i会等于1，实际因为传递的<span style="font-family:'times new roman';"><span style="font-size:16px;">typename boost::call_traits&lt;T&gt;::param_type value在参数类型是PrintClass（一个对象）时，传递的是引用。同时，我没有想到更好的办法去验证在传递的参数是int类型时，的确是通过时传值。这样说来就很有意思了，因为即使我们在使用模版时函数全部通过传值方式来设计，会在T是对象时导致很大的额外开销，我们全部通过const T&amp;的方式来传递参数就好了，就算是原生类型，这种额外开销还是小到足够忽略不计的，只是，boost库的制作者觉得这样还是不够完美？</span></span></span></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-family:'times new roman';font-size:16px;">同时，Call Traits还解决一个问题，那就是&quot;引用的引用&quot;，比如上例中T为T&amp;时的情况..........函数参数假如是通过传递引用的方式的话，const T&amp;的参数，T又等于T&amp;，那么就是const T&amp;&amp;了，C++中没有引用的引用这种东西的存在（只有指针的指针），事实上，Call Traits给函数的调用和参数的类型有完整的一套解决方案，如boost文档中的<a href="http://boost.ez2learn.com/libs/utility/call_traits.htm" id="ditm" title="example 1">example 1</a>:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">template &lt;class T&gt;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">struct contained</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">{</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // define our typedefs first, arrays are stored by value</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // so value_type is not the same as result_type:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; typedef typename boost::call_traits&lt;T&gt;::param_type &nbsp; &nbsp; &nbsp; param_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; typedef typename boost::call_traits&lt;T&gt;::reference &nbsp; &nbsp; &nbsp; &nbsp;reference;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; typedef typename boost::call_traits&lt;T&gt;::const_reference &nbsp;const_reference;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; typedef T &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;value_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; typedef typename boost::call_traits&lt;T&gt;::value_type &nbsp; &nbsp; &nbsp; result_type;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // stored value:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; value_type v_;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // constructors:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; contained() {}</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; contained(param_type p) : v_(p){}</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // return byval:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; result_type value() { return v_; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // return by_ref:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; reference get() { return v_; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; const_reference const_get()const { return v_; }</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; // pass value:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; void call(param_type p){}</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">};</span></div>
<p><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">2.<a href="http://www.boost.org/libs/utility/compressed_pair.htm">Compressed Pair</a></span></u></span></span></span><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/compressed_pair.hpp</span></span></span></span><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-family:arial;font-size:16px;">这里正好找到一个很<a href="http://hi.baidu.com/_%E2d_%B7%B3_%DE%B2%C2%D2/blog/item/2d8f76f57f0b0829bd3109cc.html" id="kvm4" title="perfect的文章">perfect的文章</a>，简单的说就是当pair中某个类是空类时，compressed Pair比std中的pair会更省一些空间（1个字节...........），我几乎没有想到我实际工作中有什么对空间要求非常高并且还会使用pair的情况.................这也就是compressed_pair的尴尬之处了。可以稍微提及的是，看看compressed pair的定义，就能看到call traits的使用：</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">template &lt;class T1, class T2&gt;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">class compressed_pair</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">{</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">public:</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef T1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; first_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef T2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; second_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;first_type&gt;::param_type &nbsp; &nbsp; &nbsp; first_param_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;second_type&gt;::param_type &nbsp; &nbsp; &nbsp;second_param_type;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;first_type&gt;::reference &nbsp; &nbsp; &nbsp; &nbsp;first_reference;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;second_type&gt;::reference &nbsp; &nbsp; &nbsp; second_reference;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;first_type&gt;::const_reference &nbsp;first_const_reference;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; typedef typename call_traits&lt;second_type&gt;::const_reference second_const_reference;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; compressed_pair() : base() {}</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; compressed_pair(first_param_type x, second_param_type y);</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; explicit compressed_pair(first_param_type x);</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; explicit compressed_pair(second_param_type y);</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; compressed_pair&amp; operator=(const compressed_pair&amp;);</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; first_reference &nbsp; &nbsp; &nbsp; first();</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; first_const_reference first() const;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; second_reference &nbsp; &nbsp; &nbsp; second();</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; second_const_reference second() const;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">&nbsp; void swap(compressed_pair&amp; y);</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-family:arial;font-size:16px;">};</span></div>
<p><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-family:arial;font-size:16px;">说实话，虽然逻辑上感觉完美了，但是代码上还真是累赘...........typedef简直就是C++强类型+类型定义复杂最大的补丁工具.............但是总的来说compress pair是很简单的东西，不多讲。</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">3.<a href="http://www.boost.org/libs/array/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000099;"><u><span style="font-size:16px;">Array</span></u></span></span></span></a><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">&nbsp;from boost/array.hpp</span></span></span></span></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:arial;"><span style="color:#000000;"><span style="font-size:16px;">Array也是最简单的boost库使用类之一了，用于以最小性能损失替代原生C语言数组，并且像vector一样，提供使用的函数和合理的封装（STL提供的vector因为是变长数组，还是有一定的性能损失）感觉不是非常非常效率要求的工程，可以将所有的C语言数组都用Array来代替，意义更加明确，迭代器使用也会更加方便，容器的使用语法也更加统一。另外，C++0X已经确定添加array库，array将来就是未来的标准库，可以较为放心的使用，并且即使使用了，也是可维护的代码（即使将来使用C++0X时也是一样）。</span></span></span></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">操作示例：</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; ">
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; boost::array&lt;int, 100&gt; intArray;</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; intArray.fill(10);</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; for (boost::array&lt;int, 100&gt;::iterator it = intArray.begin();</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; &nbsp; it != intArray.end(); ++it) {</span></div>
<p><span style="font-size:16px;"><br /></span>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; &nbsp; &nbsp; *it = 20;</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; "><span style="font-size:16px;">&nbsp; }</span></div>
<p><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">小结：</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">基本上,</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">1.call traits是看需求了，假如你实现模板库有需要才使用，不要因为真的仅仅为了一个函数的参数调用能够以最优化的方式进行而去使用call traits。</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">2.comress pair是我不太推荐使用（为了一点点空间，而增加理解的难度不值，推荐的方式是将来STL的pair实现就是compress pair）</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><span style="font-size:16px;">3.array是推荐使用</span><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;">原则是，有利于抽象和源代码易读性的用，否则不用.............</span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; "><span style="font-size:16px;"><br /></span></div>
<div style="margin-top: 0px; margin-bottom: 0px; background-color: transparent; font-family: 'Times New Roman'; margin-left: 0px; margin-right: 0px; ">
<p dir="ltr" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; text-align: right; "><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#000000;"><span style="font-size:16px;">原创文章作者保留版权 转载请注明原作者 并给出链接</span></span></span></span></p>
<p dir="ltr" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; text-align: right; "><a href="http://blog.jtianling.com/"><span style="font-style: normal; vertical-align: baseline; "><span style="font-family:'courier new';"><span style="color:#000099;"><u><strong><span style="font-size:16px;">write by 九天雁翎(JTianLing) -- blog.jtianling.com</span></strong></u></span></span></span></a><a href="http://www.jtianling.com"></a></p>
<p><span style="font-size:16px;"><a href="http://www.jtianling.com"></a><br /><a href="http://www.jtianling.com"></a><br /></span></div>
</div>
