---
layout: post
title: UCS-2与UTF8之间的选择（2）--Unicode组织提供的C/C++的Unicode编码转换函数
categories:
- "网络技术"
tags:
- C++
- UCS-2
- Unicode
- UTF-8
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '5'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1 style="margin: 24pt 0cm 0pt;"><span style="color: #365f91;"><span class="title"><span lang="EN-US"><span style="font-family: Cambria;">UCS-2</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">与</span><span lang="EN-US"><span style="font-family: Cambria;">UTF8</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">之间的选择（</span><span lang="EN-US"><span style="font-family: Cambria;">2</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">）</span><span lang="EN-US"><span style="font-family: Cambria;">--Unicode</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">组织提供的</span><span lang="EN-US"><span style="font-family: Cambria;">C/C++</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">的</span><span lang="EN-US"><span style="font-family: Cambria;">Unicode</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">编码转换函数</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps;">九天雁翎</span><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></a></span><strong><span style="text-decoration: underline;"><span style="color: #c0504d; letter-spacing: 0.25pt; font-variant: small-caps; mso-themecolor: accent2; mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US"><span style="font-size: small;">讨论新闻组及文件</span></span></span></strong></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">这里我大概搜索到了</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">3</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">个库，一个是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Unicode</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">组织自己提供的，一个是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">IBM</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">做的开源</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">ICU</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">工程中的，一个是开源的</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UCData 2.9</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">但是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UCData2.9</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">中并没有</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UTF-16,</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">通篇都是为</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UTF-32</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">设计的，属于那种将来可能会用的到的库，因为目前</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">与</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Linux</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的内核都还没有</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UTF-32</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">化，注定假如使用</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">UTF-32</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">将会在两个地方都失去性能优势。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">于是剩下的两个选择就很有意思了，一个是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Unicode</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">自己提供的那几个简单的转换函数，一个是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">IBM</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">提供的一个巨无霸的库，一个</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Unicode</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的相关库到了</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">10M</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的确算是很夸张的了，难怪被别人称作蓝色巨人，干什么都是大手笔，就像它出品的软件工程软件一样，哪一个都是出手不凡，一出一个系列，每个都大的要命。感叹。。。。。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">从</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">C/C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的库的角度，我就只查看这两个了。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<h2 style="margin: 13pt 0cm;"><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">Unicode</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">组织的函数：（甚至不能称作库）</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这些函数很好用，并且自带了测试套件。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中，新建一个空的工程，并将</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">ConvertUTF.h,CVTUTF7.h,CVTUTF7.C,harness.c</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">添加到工程中，编译，运行，既可以运行测试例程，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">utf7</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这个我们一般用不上，其实也可以不添加。在我的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">VS2005 SP1</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中，运行结果如下：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Three tests of round-trip conversions will be performed.</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">One test of illegal UTF-32 will be peroformed.</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Two illegal result messages are expected; one in test 02A; one in test 03A.</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">These are for tests of Surrogate conversion.</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Begin Test01</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">******** Test01 succeeded without error. ********</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Begin Test02</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Test02A for 55296, input 0000d800, output 0000,0000, result 3</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">!!! Test02A: note expected illegal result for 0x0000D800</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">******** Test02 succeeded without error. ********</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Begin Test03</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">sourceIllegal<span style="mso-spacerun: yes;">&nbsp;&nbsp; </span>Test03A for 55296 (0xd800); output ; result 3</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">!!! Test03A: note expected illegal result for 0x0000D800</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">******** Test03 succeeded without error. ********</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Begin Test04</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">******** Test04 succeeded without error. ********</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">很显然的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">4</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">个测试全部通过，没有任何错误。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">提供的我们可能需要的函数有：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">isLegalUTF8Sequence()</span><span style='color: #010001; line-height: 115%; font-family: "Times New Roman","serif"; mso-ascii-font-family: 新宋体; mso-fareast-font-family: 新宋体; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-language: AR-SA; mso-no-proof: yes;' lang="EN-US">&mdash;</span><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">判断一个字符串是否是合法的<span lang="EN-US">UTF8</span>字符串<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">ConvertUTF8toUTF16()</span><span style='color: #010001; line-height: 115%; font-family: "Times New Roman","serif"; mso-ascii-font-family: 新宋体; mso-fareast-font-family: 新宋体; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-language: AR-SA; mso-no-proof: yes;' lang="EN-US">&mdash;</span><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">转换<span lang="EN-US">UTF8</span>字符串到<span lang="EN-US">UTF16</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">ConvertUTF16toUTF8()</span><span style='color: #010001; line-height: 115%; font-family: "Times New Roman","serif"; mso-ascii-font-family: 新宋体; mso-fareast-font-family: 新宋体; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-language: AR-SA; mso-no-proof: yes;' lang="EN-US">&mdash;</span><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">转换<span lang="EN-US">UTF16</span>字符串到<span lang="EN-US">UTF8</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="color: #010001; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">原型：<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: #010001; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">ConversionResult</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">ConvertUTF8toUTF16</span> (</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">const</span> <span style="color: #010001;">UTF8</span>** <span style="color: #010001;">sourceStart</span>, <span style="color: blue;">const</span> <span style="color: #010001;">UTF8</span>* <span style="color: #010001;">sourceEnd</span>, </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF16</span>** <span style="color: #010001;">targetStart</span>, <span style="color: #010001;">UTF16</span>* <span style="color: #010001;">targetEnd</span>, <span style="color: #010001;">ConversionFlags</span> <span style="color: #010001;">flags</span>);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: #010001; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">ConversionResult</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">ConvertUTF16toUTF8</span> (</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">const</span> <span style="color: #010001;">UTF16</span>** <span style="color: #010001;">sourceStart</span>, <span style="color: blue;">const</span> <span style="color: #010001;">UTF16</span>* <span style="color: #010001;">sourceEnd</span>, </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF8</span>** <span style="color: #010001;">targetStart</span>, <span style="color: #010001;">UTF8</span>* <span style="color: #010001;">targetEnd</span>, <span style="color: #010001;">ConversionFlags</span> <span style="color: #010001;">flags</span>);</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">所有的函数采取的结尾判断方式是传递一个结束的指针位置，而不是常见的长度。</span><span style="mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;"> <span lang="EN-US"></span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">其提供的几个宏也很有用：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">unsigned</span> <span style="color: blue;">long</span><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF32</span>;<span style="mso-tab-count: 1;"> </span><span style="color: green;">/* at least 32 bits */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">unsigned</span> <span style="color: blue;">short</span><span style="mso-tab-count: 1;">&nbsp;&nbsp; </span><span style="color: #010001;">UTF16</span>;<span style="mso-tab-count: 1;"> </span><span style="color: green;">/* at least 16 bits */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">unsigned</span> <span style="color: blue;">char</span><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF8</span>;<span style="mso-tab-count: 1;">&nbsp; </span><span style="color: green;">/* typically 8 bits */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: blue; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">unsigned</span> <span style="color: blue;">char</span><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">Boolean</span>; <span style="color: green;">/* 0 or 1 */</span></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Boolean</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中似乎是不怎么需要</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">.</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">/* Some fundamental constants */</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#define</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">UNI_REPLACEMENT_CHAR</span> (<span style="color: #010001;">UTF32</span>)0x0000FFFD</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#define</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">UNI_MAX_BMP</span> (<span style="color: #010001;">UTF32</span>)0x0000FFFF</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#define</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">UNI_MAX_UTF16</span> (<span style="color: #010001;">UTF32</span>)0x0010FFFF</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#define</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">UNI_MAX_UTF32</span> (<span style="color: #010001;">UTF32</span>)0x7FFFFFFF</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: blue; line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#define</span><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">UNI_MAX_LEGAL_UTF32</span> (<span style="color: #010001;">UTF32</span>)0x0010FFFF</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">很有价值的几个宏，除了都强制转换为<span lang="EN-US">UTF32</span>比较郁闷，<span lang="EN-US">UNI_MAX_BMP</span>，<span lang="EN-US">UNI_MAX_UTF16</span>可以用的上。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">enum</span> {</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">conversionOK</span>, <span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green;">/* conversion successful */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">sourceExhausted</span>,<span style="mso-tab-count: 1;">&nbsp; </span><span style="color: green;">/* partial character in source, but hit end */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">targetExhausted</span>,<span style="mso-tab-count: 1;">&nbsp; </span><span style="color: green;">/* insuff. room in target for conversion */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">sourceIllegal</span><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: green;">/* source sequence is illegal/malformed */</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">} <span style="color: #010001;">ConversionResult</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">这是上述那几个函数的返回值，英文注释解释的很清楚了。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">typedef</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: blue;">enum</span> {</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">strictConversion</span> = 0,</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">lenientConversion</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">} <span style="color: #010001;">ConversionFlags</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这是那几个函数的第五参数，一个表示严格转换，一个表示宽容的转换</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: #a020f0; font-family: 宋体; mso-ascii-font-family: 'Courier New'; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-fareast-language: ZH-CN; mso-bidi-font-family: 'Courier New';">排除</span><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US">harness.c</span><span style="color: #a020f0; font-family: 宋体; mso-ascii-font-family: 'Courier New'; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-fareast-language: ZH-CN; mso-bidi-font-family: 'Courier New';">，不编译，添加</span><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US">ConvertUTF.c</span><span style="color: #a020f0; font-family: 宋体; mso-ascii-font-family: 'Courier New'; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-fareast-language: ZH-CN; mso-bidi-font-family: 'Courier New';">，自己制作一个测试：</span><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">// Unicode.cpp : </span><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">定义控制台应用程序的入口点。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">//</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#include</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #a31515;">&lt;stdio.h&gt;</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#include</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #a31515;">&lt;tchar.h&gt;</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#include</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #a31515;">&lt;windows.h&gt;</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">#include</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #a31515;">"ConvertUTF.h"</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="color: #a31515; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: blue; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US">int</span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"> <span style="color: #010001;">_tmain</span>(<span style="color: blue;">int</span> <span style="color: #010001;">argc</span>, <span style="color: #010001;">_TCHAR</span>* <span style="color: #010001;">argv</span>[])</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">{</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">ConversionResult</span> <span style="color: #010001;">result</span> = <span style="color: #010001;">sourceIllegal</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF16</span> <span style="color: #010001;">utf16_buf</span>[8] = {0};</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[0] = 0xd834;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[1] = 0xdf00;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[2] = 0xd834;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[3] = 0xdf01;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[4] = 0xd834;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[5] = 0xdf02;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[6] = 0;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16_buf</span>[7] = 0;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF16</span> *<span style="color: #010001;">utf16Start</span> = <span style="color: #010001;">utf16_buf</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF8</span> <span style="color: #010001;">utf8_buf</span>[16] = {0};</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF8</span>* <span style="color: #010001;">utf8Start</span> = <span style="color: #010001;">utf8_buf</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">MessageBoxW</span>(<span style="color: #010001;">NULL</span>, (<span style="color: #010001;">LPWSTR</span>)<span style="color: #010001;">utf16_buf</span>, <span style="color: #010001;">L</span><span style="color: #a31515;">"Before trans"</span>, <span style="color: #010001;">MB_OK</span>);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">result</span> = <span style="color: #010001;">ConvertUTF16toUTF8</span>((<span style="color: blue;">const</span> <span style="color: #010001;">UTF16</span> **) &amp;<span style="color: #010001;">utf16Start</span>, &amp;(<span style="color: #010001;">utf16_buf</span>[6]), &amp;<span style="color: #010001;">utf8Start</span>, &amp;(<span style="color: #010001;">utf8_buf</span>[16]), <span style="color: #010001;">strictConversion</span>);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">switch</span> (<span style="color: #010001;">result</span>) {</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">default</span>: <span style="color: #010001;">fprintf</span>(<span style="color: #010001;">stderr</span>, <span style="color: #a31515;">"Test02B fatal error: result %d for input %08x/n"</span>, <span style="color: #010001;">result</span>, <span style="color: #010001;">utf16_buf</span>[0]); <span style="color: #010001;">exit</span>(1);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">conversionOK</span>: <span style="color: blue;">break</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">sourceExhausted</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"sourceExhausted/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">targetExhausted</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"targetExhausted/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">sourceIllegal</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"sourceIllegal/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: green;">// </span></span><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">清空缓存，以确定以后的值的确是转换得来<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">ZeroMemory</span>(<span style="color: #010001;">utf16_buf</span>, <span style="color: blue;">sizeof</span>(<span style="color: #010001;">utf16_buf</span>));</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: green;">// </span></span><span style="color: green; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">由于转换中利用了这两个<span lang="EN-US">start</span>，所以需要重新为<span lang="EN-US">start</span>定位<span lang="EN-US">,</span>并且保存住<span lang="EN-US">End</span>值<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">UTF8</span>* <span style="color: #010001;">utf8End</span> = <span style="color: #010001;">utf8Start</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf8Start</span> = <span style="color: #010001;">utf8_buf</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">utf16Start</span> = <span style="color: #010001;">utf16_buf</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">result</span> = <span style="color: #010001;">ConvertUTF8toUTF16</span>((<span style="color: blue;">const</span> <span style="color: #010001;">UTF8</span> **) &amp;<span style="color: #010001;">utf8Start</span>, <span style="color: #010001;">utf8End</span>, &amp;<span style="color: #010001;">utf16Start</span>, &amp;(<span style="color: #010001;">utf16_buf</span>[6]), <span style="color: #010001;">strictConversion</span>);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">switch</span> (<span style="color: #010001;">result</span>) {</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">default</span>: <span style="color: #010001;">fprintf</span>(<span style="color: #010001;">stderr</span>, <span style="color: #a31515;">"Test02B fatal error: result %d for input %08x/n"</span>, <span style="color: #010001;">result</span>, <span style="color: #010001;">utf16_buf</span>[0]); <span style="color: #010001;">exit</span>(1);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">conversionOK</span>: <span style="color: blue;">break</span>;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">sourceExhausted</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"sourceExhausted/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">targetExhausted</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"targetExhausted/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">case</span> <span style="color: #010001;">sourceIllegal</span>: <span style="color: #010001;">printf</span>(<span style="color: #a31515;">"sourceIllegal/t"</span>); <span style="color: #010001;">exit</span>(0);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: #010001;">MessageBoxW</span>(<span style="color: #010001;">NULL</span>, (<span style="color: #010001;">LPWSTR</span>)<span style="color: #010001;">utf16_buf</span>, <span style="color: #010001;">L</span><span style="color: #a31515;">"After Trans"</span>, <span style="color: #010001;">MB_OK</span>);</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="color: blue;">return</span> 0;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">利用的还是以前的太玄经字符，经测试，两次的<span lang="EN-US">MessageBox</span>显示均正常，唯一需要注意的是由于转换函数的第<span lang="EN-US">1</span>，<span lang="EN-US">3</span>个参数都是以指针的指针为参数，并且跟进实现中可以发现，实现中利用了此指针的偏转来完成长度的判断，并且利用此值作为结束的返回，好处自然是还是以指针作为结束的返回了，坏处就是你需要重新利用的时候需要重新定位。如上述源代码及中间的注释所示，这可能也就是这些函数唯一需要注意的地方了，因为和平时对长度的判断不同。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">至于为什么要这样做，可能是出于效率的考虑，就像<span lang="EN-US">C</span>语言中以<span lang="EN-US">NULL</span>为字符串的结束标志而不是在字符串前加一个长度一样，虽然此点因为容易导致严重的越界问题而被人诟病，但是实际上，这样比记长度能够更加有效率的处理字符串是很多人没有发现的。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">当以某个值为结束标志（比如<span lang="EN-US">C </span>语言中的<span lang="EN-US">NULL</span>）时，遍历只需要偏移起始指针，并在循环每次做一个判断，大概如下形式，这样每次循环只需要一次的比较，一次的<span lang="EN-US">++</span>。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">for(; p != NULL; ++p) </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">{ </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>// </span><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;">此处可以直接处理<span lang="EN-US">*p</span>了<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="line-height: 115%; font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">假如是长度呢？</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">可能需要如下形式，一方面需要额外的一个临时变量，一方面对字符串中值的调用效率也更加低了。而这些消耗在以</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">&rsquo;/0&rsquo;</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">结尾时就不存在。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">for(int i = 0; i &lt; END; ++i)</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">{</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>// p[i]</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">或者</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">p+i</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的处理方式</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">}</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这点也很好解释，为什么到了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中迭代器还是喜欢用类似的形式：）</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">for(lit = container.begin(); lit != container.end(); ++lit) </span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">{</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;"><span style="mso-spacerun: yes;">&nbsp;</span>// </span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">直接使用</span><span style="mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;"> <span lang="EN-US">*lit</span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">}</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这在效率至上的世界中，很好理解。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">九天雁翎</span></span></strong><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
