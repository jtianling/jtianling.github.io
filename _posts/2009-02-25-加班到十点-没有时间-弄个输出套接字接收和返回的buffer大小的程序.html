---
layout: post
title: "加班到十点，没有时间，弄个输出套接字接收和返回的Buffer大小的程序"
categories:
- "网络技术"
tags: []
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '4'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1 style="margin: 24pt 0cm 0pt;"><span style="color: #365f91;"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">加班到十点，没有时间，弄个输出套接字接收和返回的</span><span lang="EN-US"><span style="font-family: Cambria;">Buffer</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">大小的程序</span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps;">九天雁翎</span><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><strong><span style="text-decoration: underline;"><span style="color: #c0504d; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN; mso-themecolor: accent2;" lang="EN-US"></span></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US"><span style="font-size: small; color: #800080;">讨论新闻组及文件</span></span></span></strong></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 258pt; text-indent: -258pt; line-height: normal;"><span style="font-family: 宋体; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;"><span style="font-size: small;">在<span lang="EN-US">Ubuntu8.04</span>桌面版下，测试的结果为<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 258pt; text-indent: -258pt; line-height: normal;"><span style="font-family: 宋体; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-size: small;">Socket default Receive Buffer is 87380</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 258pt; text-indent: -258pt; line-height: normal;"><span style="font-family: 宋体; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-size: small;">Socket default Send Buffer is 16384</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 258pt; text-indent: -258pt; line-height: normal;"><span style="font-family: 宋体; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;"><span style="font-size: small;">与作者在<span lang="EN-US">freebsd4.8</span>中的稍有不同，接收缓冲区略大，发送缓冲区略小。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">作者得出的结果分别是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">57344,32768</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">在我的系统中，接收的缓存实在是够大</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="color: #a020f0; font-family: 宋体; mso-ascii-font-family: 'Courier New'; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; mso-fareast-language: ZH-CN;">源代码：</span><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style='color: #804040; font-family: "Courier New";' lang="EN-US">&nbsp;1 </span><span style='color: #a020f0; font-family: "Courier New";' lang="EN-US">#include&nbsp;&nbsp;&nbsp;&nbsp;</span><span style='color: fuchsia; font-family: "Courier New";' lang="EN-US">"unp.h"</span></span><span style='font-family: "Courier New";' lang="EN-US"><br /><span style="font-size: small;"><span style="color: #804040;">&nbsp;2 </span><br /><span style="color: #804040;">&nbsp;3 </span><strong><span style="color: seagreen;">int</span></strong>&nbsp;main(<strong><span style="color: seagreen;">int</span></strong>&nbsp;argc, <strong><span style="color: seagreen;">char</span></strong>&nbsp;**argv)<br /><span style="color: #804040;">&nbsp;4 </span>{<br /><span style="color: #804040;">&nbsp;5 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: seagreen;">int</span></strong>&nbsp;&nbsp;&nbsp;&nbsp;sockfd, n;<br /><span style="color: #804040;">&nbsp;6 </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">/*&nbsp;&nbsp; struct sockaddr_in&nbsp;&nbsp;&nbsp;&nbsp;servaddr; */</span><br /><span style="color: #804040;">&nbsp;7 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: seagreen;">int</span></strong>&nbsp;liRcvSize = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">&nbsp;8 </span>&nbsp;&nbsp;&nbsp;&nbsp;socklen_t liRcvLen = <strong><span style="color: #804040;">sizeof</span></strong>(liRcvSize);<br /><span style="color: #804040;">&nbsp;9 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: seagreen;">int</span></strong>&nbsp;liSndSize = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">10 </span>&nbsp;&nbsp;&nbsp;&nbsp;socklen_t liSndLen = <strong><span style="color: #804040;">sizeof</span></strong>(liSndSize);<br /><span style="color: #804040;">11 </span><br /><span style="color: #804040;">12 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">if</span></strong>&nbsp;((sockfd = Socket(AF_INET, SOCK_STREAM, <span style="color: fuchsia;">0</span>)) &lt; <span style="color: fuchsia;">0</span>)<br /><span style="color: #804040;">13 </span>&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="color: #804040;">14 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_sys(<span style="color: fuchsia;">"Socket Create failed</span><span style="color: slateblue;">/n</span><span style="color: fuchsia;">"</span>);<br /><span style="color: #804040;">15 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">16 </span><br /><span style="color: #804040;">17 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">if</span></strong>&nbsp;( ( n = getsockopt(sockfd, SOL_SOCKET, SO_RCVBUF, &amp;liRcvSize, &amp;liRcvLen) ) &lt; <span style="color: fuchsia;">0</span>)<br /><span style="color: #804040;">18 </span>&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="color: #804040;">19 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_sys(<span style="color: fuchsia;">"getsocketopt recv buffer run failed</span><span style="color: slateblue;">/n</span><span style="color: fuchsia;">"</span>);<br /><span style="color: #804040;">20 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">21 </span><br /><span style="color: #804040;">22 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">if</span></strong>&nbsp;( ( n = getsockopt(sockfd, SOL_SOCKET, SO_SNDBUF, &amp;liSndSize, &amp;liSndLen) ) &lt; <span style="color: fuchsia;">0</span>)<br /><span style="color: #804040;">23 </span>&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="color: #804040;">24 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err_sys(<span style="color: fuchsia;">"getsocketopt send buffer run failed</span><span style="color: slateblue;">/n</span><span style="color: fuchsia;">"</span>);<br /><span style="color: #804040;">25 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">26 </span><br /><span style="color: #804040;">27 </span>&nbsp;&nbsp;&nbsp;&nbsp;close(sockfd);<br /><span style="color: #804040;">28 </span><br /><span style="color: #804040;">29 </span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"Socket default Receive Buffer is </span><span style="color: slateblue;">%d/n</span><span style="color: fuchsia;">"</span>, liRcvSize);<br /><span style="color: #804040;">30 </span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"Socket default Send Buffer is </span><span style="color: slateblue;">%d/n</span><span style="color: fuchsia;">"</span>, liSndSize);<br /><span style="color: #804040;">31 </span><br /><span style="color: #804040;">32 </span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color: #804040;">33 </span>&nbsp;&nbsp;&nbsp;&nbsp;exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">34 </span>}</span></span><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">Thread model: posix</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">gcc version 4.2.4 (Ubuntu 4.2.4-1ubuntu4)</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">纯</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">ANSI C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">九天雁翎</span></span></strong><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
