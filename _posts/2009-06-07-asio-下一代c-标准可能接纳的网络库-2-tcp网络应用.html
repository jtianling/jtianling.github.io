---
layout: post
title: ASIO—下一代C++标准可能接纳的网络库（2）TCP网络应用
categories:
- "网络技术"
tags:
- ASIO
- Boost
- C++
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '9'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1 style="margin: 24pt 0cm 0pt 21pt; text-indent: 0cm; mso-list: none;"><span style="color: #365f91;"><span lang="EN-US"><span style="font-family: Cambria;">ASIO&mdash;</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">下一代</span><span lang="EN-US"><span style="font-family: Cambria;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">标准可能接纳的网络库（</span><span lang="EN-US"><span style="font-family: Cambria;">2</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">）</span><span lang="EN-US"><span style="font-family: Cambria;">TCP</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">网络应用</span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: large;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps;">九天雁翎</span><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><strong><span style="text-decoration: underline;"><span style="color: #c0504d; letter-spacing: 0.25pt; font-variant: small-caps; mso-themecolor: accent2; mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US"><span style="font-size: large; color: #800080;">讨论新闻组及文件</span></span></span></strong></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<h1 style="margin: 24pt 0cm 0pt 21pt;"><span style="color: #365f91;"><span style="mso-bidi-font-family: 宋体; mso-bidi-theme-font: major-fareast;" lang="EN-US"><span style="mso-list: Ignore;"><span style="font-family: Cambria;">一、</span><span style='font: 7pt "Times New Roman";'>&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">综述</span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">本文仅仅是附着在</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">文档的一个简单说明和讲解，没有</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">文档可能你甚至都不知道我在讲什么，</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的文档自然是需要从</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><a href="http://www.boost.org/"><span style="color: #800080; font-family: Calibri;">www.boost.org</span></a></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">上去下。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-indent: 21pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">基本上，网络编程领域的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">&rdquo;Hello World&rdquo;</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">程序就是类似</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Echo</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">等服务器应用了。大牛</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Stevens</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">经典的《</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Unix Network Programming</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">》一书更是在这两个服务器上折腾了半本书，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Comer</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的《</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Internetworking With TCP/IP vol III</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">》也不例外。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的文档也就更不例外了，全部的网络方面的例子都是以</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">服务为蓝本来讲解的。呵呵，大家这样做是有道理的，毕竟从讲解网络编程的原理来看，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">echo,daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">等足够的简单：）</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<h1 style="margin: 24pt 0cm 0pt 21pt;"><span style="color: #365f91;"><span style="font-weight: normal; mso-bidi-font-family: 宋体; mso-bidi-theme-font: major-fareast; mso-bidi-font-weight: bold;" lang="EN-US"><span style="mso-list: Ignore;"><span style="font-family: Cambria;">二、</span><span style='font: 7pt "Times New Roman";'>&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-weight: normal; mso-bidi-font-weight: bold;" lang="EN-US"><span style="font-family: Cambria;">Tutorial</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">首先，因为客户端程序相对服务器程序更为简单，所以一般都从客户端开始，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">也是如此，第一节，给出了一个</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">TCP </span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的实现所谓示例，这里，我不拷贝其源码了，只是列出一个用</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">windows </span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下用套接字接口实现的同样程序作为对比。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<h2 style="margin: 13pt 0cm 13pt 21pt;"><span style="mso-fareast-font-family: Cambria; mso-fareast-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-font-family: Cambria; mso-bidi-theme-font: major-latin; mso-bidi-language: AR-SA;" lang="EN-US"><span style="mso-list: Ignore;"><span style="font-size: large; font-family: Cambria;">1.</span><span style='font: 7pt "Times New Roman";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">A synchronous TCP daytime client</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">（一个同步的</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">TCP daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">客户端程序）</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">原始的套接字实现：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include &lt;stdio.h&gt;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include &lt;string.h&gt;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include "Winsock2.h"</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include "errno.h"</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include "stdlib.h"</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#define </span></span><span style="color: #010001;" lang="EN-US">MAXLINE</span><span lang="EN-US"><span style="color: #0000ff;"> 1000</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">void </span></span><span style="color: #010001;" lang="EN-US">str_cli</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">SOCKET</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>char </span></span><span style="color: #010001;" lang="EN-US">recvline</span><span lang="EN-US"><span style="color: #0000ff;">[</span></span><span style="color: #010001;" lang="EN-US">MAXLINE</span><span lang="EN-US"><span style="color: #0000ff;">] = {0};</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>while ( (</span></span><span style="color: #010001;" lang="EN-US">recv</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">recvline</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">MAXLINE</span><span lang="EN-US"><span style="color: #0000ff;">, 0)) != </span></span><span style="color: #010001;" lang="EN-US">NULL</span><span lang="EN-US"><span style="color: #0000ff;">) </span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">("%s", </span></span><span style="color: #010001;" lang="EN-US">recvline</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">int </span></span><span style="color: #010001;" lang="EN-US">main</span><span lang="EN-US"><span style="color: #0000ff;">(int </span></span><span style="color: #010001;" lang="EN-US">argc</span><span lang="EN-US"><span style="color: #0000ff;">, char **</span></span><span style="color: #010001;" lang="EN-US">argv</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WORD</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;"> = 0;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSADATA</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">wsaData</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>int </span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">MAKEWORD</span><span lang="EN-US"><span style="color: #0000ff;">( 2, 2 );</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: green;" lang="EN-US">// windows</span><span style="color: green;">下此初始化为必须，实际是初始化<span lang="EN-US">WinsockDLL</span>的过程<span lang="EN-US"></span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">WSAStartup</span><span lang="EN-US"><span style="color: #0000ff;">( </span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;">, &amp;</span></span><span style="color: #010001;" lang="EN-US">wsaData</span><span lang="EN-US"><span style="color: #0000ff;"> );</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if ( </span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;"> != 0 ) {</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return -1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">SOCKET</span><span lang="EN-US"><span style="mso-tab-count: 5;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>struct </span></span><span style="color: #010001;" lang="EN-US">sockaddr_in</span><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">argc</span><span lang="EN-US"><span style="color: #0000ff;"> != 2)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">("usage: tcpcli &lt;IPaddress&gt;");</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">exit</span><span lang="EN-US"><span style="color: #0000ff;">(1);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">AF_INET</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">SOCK_STREAM</span><span lang="EN-US"><span style="color: #0000ff;">, 0);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">ZeroMemory</span><span lang="EN-US"><span style="color: #0000ff;">(&amp;</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">, sizeof(</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">));</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_family</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">AF_INET</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_port</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">htons</span><span lang="EN-US"><span style="color: #0000ff;">(13);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_addr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">s_addr</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">inet_addr</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">argv</span><span lang="EN-US"><span style="color: #0000ff;">[1]);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if( </span></span><span style="color: #010001;" lang="EN-US">SOCKET_ERROR</span><span lang="EN-US"><span style="color: #0000ff;"> == </span></span><span style="color: #010001;" lang="EN-US">connect</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">, (struct </span></span><span style="color: #010001;" lang="EN-US">sockaddr</span><span lang="EN-US"><span style="color: #0000ff;"> *) &amp;</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">, sizeof(</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">)))</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">("connet failed, Error Code: %d", </span></span><span style="color: #010001;" lang="EN-US">WSAGetLastError</span><span lang="EN-US"><span style="color: #0000ff;">());</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return -1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">str_cli</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">sockfd</span><span lang="EN-US"><span style="color: #0000ff;">);<span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: green;" lang="EN-US">/* do it all */</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="color: green;" lang="EN-US"><span style="font-size: small; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">("pause");</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">exit</span><span lang="EN-US"><span style="color: #0000ff;">(0);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">共六十一行，并且需要处理</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">创建，初始化等繁琐细节，做任何决定时基本上是通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">typecode</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">，其实相对来说也不算太难，因为除了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">接口属于需要额外学习的东西，没有太多除了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">语言以外的东西需要学习，并且因为</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">BSD socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">是如此的出名，以至于几乎等同与事实的标准，所以这样的程序能被大部分学习过一定网络编程知识的人了解。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">为了方便对比，我还是贴一下</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">示例中的代码：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include &lt;iostream&gt;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include &lt;boost/array.hpp&gt;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">#include &lt;boost/asio.hpp&gt;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">using </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">ip</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">int </span></span><span style="color: #010001;" lang="EN-US">main</span><span lang="EN-US"><span style="color: #0000ff;">(int </span></span><span style="color: #010001;" lang="EN-US">argc</span><span lang="EN-US"><span style="color: #0000ff;">, char* </span></span><span style="color: #010001;" lang="EN-US">argv</span><span lang="EN-US"><span style="color: #0000ff;">[])</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>try</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">argc</span><span lang="EN-US"><span style="color: #0000ff;"> != 2)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">cerr</span><span lang="EN-US"><span style="color: #0000ff;"> &lt;&lt; "Usage: client &lt;host&gt;" &lt;&lt; </span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">endl</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return 1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">query</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">query</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">argv</span><span lang="EN-US"><span style="color: #0000ff;">[1], "daytime");</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">iterator</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">endpoint_iterator</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">resolve</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">query</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">resolver</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">iterator</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">end</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">error_code</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">host_not_found</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>while (</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;"> &amp;&amp; </span></span><span style="color: #010001;" lang="EN-US">endpoint_iterator</span><span lang="EN-US"><span style="color: #0000ff;"> != </span></span><span style="color: #010001;" lang="EN-US">end</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">close</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">connect</span><span lang="EN-US"><span style="color: #0000ff;">(*</span></span><span style="color: #010001;" lang="EN-US">endpoint_iterator</span><span lang="EN-US"><span style="color: #0000ff;">++, </span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>throw </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system_error</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>for (;;)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::array&lt;char, 128&gt; </span></span><span style="color: #010001;" lang="EN-US">buf</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">error_code</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">size_t</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">len</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">read_some</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">buffer</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">buf</span><span lang="EN-US"><span style="color: #0000ff;">), </span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;"> == </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">eof</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>break; </span></span><span style="color: green;" lang="EN-US">// Connection closed cleanly by peer.</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>else if (</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>throw </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system_error</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">error</span><span lang="EN-US"><span style="color: #0000ff;">); </span></span><span style="color: green;" lang="EN-US">// Some other error.</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">cout</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">write</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">buf</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">data</span><span lang="EN-US"><span style="color: #0000ff;">(), </span></span><span style="color: #010001;" lang="EN-US">len</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>catch (</span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">exception</span><span lang="EN-US"><span style="color: #0000ff;">&amp; </span></span><span style="color: #010001;" lang="EN-US">e</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">cerr</span><span lang="EN-US"><span style="color: #0000ff;"> &lt;&lt; </span></span><span style="color: #010001;" lang="EN-US">e</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">what</span><span lang="EN-US"><span style="color: #0000ff;">() &lt;&lt; </span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">endl</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>return 0;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的文档中的实现也有</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">47</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">行，用了多个</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">try,catch</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">来处理异常，因为其实现的原因，引入了较多的额外复杂度，除了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">以外，即便你很熟悉</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++,</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">你也得进一步的了解诸如</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::array, boost:system</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">等知识，（虽然其实很简单）并且，从使用上来说，感觉并没有比普通的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">简单，虽然如此，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">此例子还是有其优势的，比如</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">ipv4,ipv6</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的自适应（原</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">仅仅支持</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">ipv4</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">），出错时更人性化的提示</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">(</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">此点由</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">异常特性支持，相对比</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">语言中常常只能有个</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">error code)</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">当然，此例子过于简单，而</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">是为了较大规模程序的实现而设计的，假如这么小规模的程序用原始的套接字就足够了。这点是需要说明的。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<h2 style="margin: 13pt 0cm 13pt 21pt;"><span style="mso-fareast-font-family: Cambria; mso-fareast-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-font-family: Cambria; mso-bidi-theme-font: major-latin; mso-bidi-language: AR-SA;" lang="EN-US"><span style="mso-list: Ignore;"><span style="font-size: large; font-family: Cambria;">2.</span><span style='font: 7pt "Times New Roman";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">Daytime.2 - A synchronous TCP daytime server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">（同步的</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">TCP daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">服务器）</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">有了客户端没有服务器，那客户端有什么用呢？</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">^^</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">所以，接下来</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">适时的给出了一个</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的服务器实现，</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">这里还是先给出使用一个原始套接字的例子：</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">&lt;time.h&gt;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">"Winsock2.h"</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">"errno.h"</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">"stdlib.h"</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="color: #a31515;" lang="EN-US"><span style="font-size: small; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#define </span></span><span style="color: #010001;" lang="EN-US">MAXLINE</span><span lang="EN-US"><span style="color: #0000ff;"> 1000</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">int </span></span><span style="color: #010001;" lang="EN-US">main</span><span lang="EN-US"><span style="color: #0000ff;">(int </span></span><span style="color: #010001;" lang="EN-US">argc</span><span lang="EN-US"><span style="color: #0000ff;">, char **</span></span><span style="color: #010001;" lang="EN-US">argv</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WORD</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;"> = 0;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSADATA</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">wsaData</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>int </span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">MAKEWORD</span><span lang="EN-US"><span style="color: #0000ff;">( 2, 2 );</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: green;" lang="EN-US">// windows</span><span style="color: green;">下此初始化为必须，实际是初始化<span lang="EN-US">WinsockDLL</span>的过程<span lang="EN-US"></span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">WSAStartup</span><span lang="EN-US"><span style="color: #0000ff;">( </span></span><span style="color: #010001;" lang="EN-US">wVersionRequested</span><span lang="EN-US"><span style="color: #0000ff;">, &amp;</span></span><span style="color: #010001;" lang="EN-US">wsaData</span><span lang="EN-US"><span style="color: #0000ff;"> );</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if ( </span></span><span style="color: #010001;" lang="EN-US">err</span><span lang="EN-US"><span style="color: #0000ff;"> != 0 ) {</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return -1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">SOCKET</span><span lang="EN-US"><span style="mso-tab-count: 5;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>struct </span></span><span style="color: #010001;" lang="EN-US">sockaddr_in</span><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>char<span style="mso-tab-count: 4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">buff</span><span lang="EN-US"><span style="color: #0000ff;">[</span></span><span style="color: #010001;" lang="EN-US">MAXLINE</span><span lang="EN-US"><span style="color: #0000ff;">];</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">time_t</span><span lang="EN-US"><span style="mso-tab-count: 4;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">ticks</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">AF_INET</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">SOCK_STREAM</span><span lang="EN-US"><span style="color: #0000ff;">, 0);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">ZeroMemory</span><span lang="EN-US"><span style="color: #0000ff;">(&amp;</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">, sizeof(</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">));</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_family</span><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>= </span></span><span style="color: #010001;" lang="EN-US">AF_INET</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_addr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">s_addr</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">htonl</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">INADDR_ANY</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">sin_port</span><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>= </span></span><span style="color: #010001;" lang="EN-US">htons</span><span lang="EN-US"><span style="color: #0000ff;">(13);<span style="mso-tab-count: 1;">&nbsp; </span></span></span><span style="color: green;" lang="EN-US">/* daytime server */</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="color: green;" lang="EN-US"><span style="font-size: small; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if( </span></span><span style="color: #010001;" lang="EN-US">bind</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">, (struct </span></span><span style="color: #010001;" lang="EN-US">sockaddr</span><span lang="EN-US"><span style="color: #0000ff;"> *) &amp;</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">, sizeof(</span></span><span style="color: #010001;" lang="EN-US">servaddr</span><span lang="EN-US"><span style="color: #0000ff;">))</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>== </span></span><span style="color: #010001;" lang="EN-US">SOCKET_ERROR</span><span lang="EN-US"><span style="color: #0000ff;">) </span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #a31515;" lang="EN-US">"bind failed: %d/n"</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">WSAGetLastError</span><span lang="EN-US"><span style="color: #0000ff;">());</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSACleanup</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return 1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">listen</span><span lang="EN-US"><span style="color: #0000ff;">( </span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">SOMAXCONN</span><span lang="EN-US"><span style="color: #0000ff;"> ) == </span></span><span style="color: #010001;" lang="EN-US">SOCKET_ERROR</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #a31515;" lang="EN-US">"Error listening on socket./n"</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSACleanup</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return 1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>for ( ; ; ) </span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">accept</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">, (struct </span></span><span style="color: #010001;" lang="EN-US">sockaddr</span><span lang="EN-US"><span style="color: #0000ff;">*) </span></span><span style="color: #010001;" lang="EN-US">NULL</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">NULL</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if (</span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;"> == </span></span><span style="color: #010001;" lang="EN-US">INVALID_SOCKET</span><span lang="EN-US"><span style="color: #0000ff;">) </span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #a31515;" lang="EN-US">"accept failed: %d/n"</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">WSAGetLastError</span><span lang="EN-US"><span style="color: #0000ff;">());</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">listenfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSACleanup</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return 1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">ticks</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">time</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">NULL</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">_snprintf</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">buff</span><span lang="EN-US"><span style="color: #0000ff;">, sizeof(</span></span><span style="color: #010001;" lang="EN-US">buff</span><span lang="EN-US"><span style="color: #0000ff;">), </span></span><span style="color: #a31515;" lang="EN-US">"%.24s/r/n"</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">ctime</span><span lang="EN-US"><span style="color: #0000ff;">(&amp;</span></span><span style="color: #010001;" lang="EN-US">ticks</span><span lang="EN-US"><span style="color: #0000ff;">));</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if( </span></span><span style="color: #010001;" lang="EN-US">SOCKET_ERROR</span><span lang="EN-US"><span style="color: #0000ff;"> == </span></span><span style="color: #010001;" lang="EN-US">send</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">buff</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">strlen</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">buff</span><span lang="EN-US"><span style="color: #0000ff;">), 0))</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">printf</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #a31515;" lang="EN-US">"send failed: %d/n"</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">WSAGetLastError</span><span lang="EN-US"><span style="color: #0000ff;">());</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSACleanup</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return 1;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">closesocket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">connfd</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">WSACleanup</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>return 0;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">全程序</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">75</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">行，大部分用于</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的初始化，及其状态的转换，直到真正的进入监听状态并开始接受连接，每个</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">socket API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的调用都需要判断返回值，这也算是</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">语言程序共同的特点。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">另外，看看</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的实现。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">&lt;ctime&gt;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">&lt;iostream&gt;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">&lt;string&gt;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">#include </span></span><span style="color: #a31515;" lang="EN-US">&lt;boost/asio.hpp&gt;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">using </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">ip</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">string</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">make_daytime_string</span><span lang="EN-US"><span style="color: #0000ff;">()</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>using namespace </span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">; </span></span><span style="color: green;" lang="EN-US">// For time_t, time and ctime;</span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">time_t</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">now</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">time</span><span lang="EN-US"><span style="color: #0000ff;">(0);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>return </span></span><span style="color: #010001;" lang="EN-US">ctime</span><span lang="EN-US"><span style="color: #0000ff;">(&amp;</span></span><span style="color: #010001;" lang="EN-US">now</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;">int </span></span><span style="color: #010001;" lang="EN-US">main</span><span lang="EN-US"><span style="color: #0000ff;">()</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">{</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>try</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">acceptor</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">acceptor</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">endpoint</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">v4</span><span lang="EN-US"><span style="color: #0000ff;">(), 13));</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>for (;;)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">tcp</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">io_service</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">acceptor</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">accept</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">string</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">message</span><span lang="EN-US"><span style="color: #0000ff;"> = </span></span><span style="color: #010001;" lang="EN-US">make_daytime_string</span><span lang="EN-US"><span style="color: #0000ff;">();</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">system</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">error_code</span><span lang="EN-US"><span style="color: #0000ff;"> </span></span><span style="color: #010001;" lang="EN-US">ignored_error</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 3;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">write</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">socket</span><span lang="EN-US"><span style="color: #0000ff;">, </span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">buffer</span><span lang="EN-US"><span style="color: #0000ff;">(</span></span><span style="color: #010001;" lang="EN-US">message</span><span lang="EN-US"><span style="color: #0000ff;">),</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 4;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">boost</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">asio</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">transfer_all</span><span lang="EN-US"><span style="color: #0000ff;">(), </span></span><span style="color: #010001;" lang="EN-US">ignored_error</span><span lang="EN-US"><span style="color: #0000ff;">);</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="color: #0000ff;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>catch (</span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">exception</span><span lang="EN-US"><span style="color: #0000ff;">&amp; </span></span><span style="color: #010001;" lang="EN-US">e</span><span lang="EN-US"><span style="color: #0000ff;">)</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>{</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: 新宋体;"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">cerr</span><span lang="EN-US"><span style="color: #0000ff;"> &lt;&lt; </span></span><span style="color: #010001;" lang="EN-US">e</span><span lang="EN-US"><span style="color: #0000ff;">.</span></span><span style="color: #010001;" lang="EN-US">what</span><span lang="EN-US"><span style="color: #0000ff;">() &lt;&lt; </span></span><span style="color: #010001;" lang="EN-US">std</span><span lang="EN-US"><span style="color: #0000ff;">::</span></span><span style="color: #010001;" lang="EN-US">endl</span><span lang="EN-US"><span style="color: #0000ff;">;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>}</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small;"><span style="color: #0000ff;"><span style="font-family: 新宋体;"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span>return 0;</span></span></span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">}</span></span></p>
<p class="C" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><span style="font-size: small; color: #0000ff; font-family: 新宋体;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;" lang="EN-US">全程序</span><span lang="EN-US"><span style="font-family: Calibri;">35</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;" lang="EN-US">行</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">，比使用原始套接字的版本省略了一半，并且还是保持着可移植性（我的例子只能在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下运行）。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">从其文档和实现来看，实现上将很多函数转化为类了，使用上也没有简化一些。。。做出这样的结论还是当我处于对</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的熟悉程度要远大于</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的情况。也许对于纯粹的初学者，要学习</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">会比</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">socket API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">简单更多一些。毕竟相当多的细节，比如各种情况下的错误返回，各类接口需要传入的适当的参数，甚至套接字初始化，状态的转换等等在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中都简化了太多。此例中的例子就是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">accept</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">函数在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中实现为了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">acceptor</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">类。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">另外，这里值得说明一下，虽然</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">BSD socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">套接字属于事实上的标准，但是其实同一套程序不经过一定的更改要放在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Linux,Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">上同时运行是不可能的，因为其中总有些细微的差别，总记得刚开始工作的时候，拿着《</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Unix Network Programming</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">》在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下去学习，结果一个小程序都用不了。。。结果是完全不知道</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下特有的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">WSAStartup</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">初始化</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">-_-!</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">但是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">就彻底的消除了这样的差别。这也应该算是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的一个优势吧。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<h2 style="margin: 13pt 0cm 13pt 21pt;"><span style="mso-fareast-font-family: Cambria; mso-fareast-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-font-family: Cambria; mso-bidi-theme-font: major-latin; mso-bidi-language: AR-SA;" lang="EN-US"><span style="mso-list: Ignore;"><span style="font-size: large; font-family: Cambria;">3.</span><span style='font: 7pt "Times New Roman";'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">An asynchronous TCP daytime server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">（异步</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Cambria;">TCP daytime</span></span><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">服务器）</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">与原有</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的简单应用一样，从第三个例子开始就已</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">经是有点意思了的程序了，程序的复杂性上来了，异步相对同步来说效率更高是不争的事实，并且其不会阻塞的特性使得应用范围更广，并且异步也是大部分高性能服务器实际上使用的方式，比如</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">下的完成端口，</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Linux</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">下的</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">Epoll</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">等，</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的底层就是用这些方式实现的，只不过将其封装起来，使得使用更加简单了。这里提供异步的例子就不是那么简单了</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">-_-!</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">呵呵，偷懒的我暂时就不提供了。</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">其实用</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">select</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">也是可以模拟出异步的特性的，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">在操作系统没有很好的支持异步特性的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">API</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">时，就是利用</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">select</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">模拟出异步的。</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">但是作为</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;" lang="EN-US"><span style="font-family: Calibri;">select</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA;">的例子，可以参考我以前学习时写的《</span></span><strong><span style='font-size: 11.5pt; color: black; line-height: 115%; font-family: "Verdana","sans-serif"; mso-font-kerning: 18.0pt;' lang="EN-US"><a href="http://www.jtianling.com/archive/2009/03/02/3948204.aspx"><span style="color: #770000; font-family: 宋体; text-decoration: none; mso-ascii-font-family: Verdana; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Verdana; mso-fareast-language: ZH-CN; text-underline: none;" lang="EN-US"><span lang="EN-US">服务器</span></span><span style="color: #770000; text-decoration: none; mso-fareast-language: ZH-CN; text-underline: none;">Select</span><span style="color: #770000; font-family: 宋体; text-decoration: none; mso-ascii-font-family: Verdana; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Verdana; mso-fareast-language: ZH-CN; text-underline: none;" lang="EN-US"><span lang="EN-US">模型的实现</span></span></a></span></strong><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;"><span style="font-size: large;">》</span></span><strong><span style="font-size: 11.5pt; color: black; line-height: 115%; font-family: 宋体; mso-ascii-font-family: Verdana; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Verdana; mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;">。</span></strong><strong><span style='font-size: 11.5pt; color: black; line-height: 115%; font-family: "Verdana","sans-serif"; mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;' lang="EN-US"></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;">例子中用</span><span style="mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;" lang="EN-US"><span style="font-family: Calibri;">tcp_server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;">类处理</span><span style="mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;" lang="EN-US"><span style="font-family: Calibri;">accept</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-font-kerning: 18.0pt;">事件，用</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">tcp_connection</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">类来处理连接后的写入事件，并且用</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">shared_ptr</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">来保存</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">tcp_connection</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">类的对象。</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">总结：</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">的确在某种程度上简化了网络客户端</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">/</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">服务器程序的编写，并且易于编写出效率较高的网络应用，（效率能高到什么程度没有实测）但是，作为与</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">C</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">程序员一脉相承的</span><span style="mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA; mso-no-proof: yes;">程序员，</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">在完全不了解诸如</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio:: async_write</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">asio:: async_accept</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">等函数的实现时有多大的胆量去放心使用，这是个问题。说要去真的理解其实现吧。。。那么就将陷入真正的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">精密</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">技巧使用的泥潭，因为</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">与其他</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">库结合的是如此的紧密，特别是</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::bind,</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">而</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::bind</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">现在的实现实在不是那么优美，并且在下一版的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">标准</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;" lang="EN-US">中</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">variadic templates</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;" lang="EN-US">的</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">加入，是会使其实现简化很多的，这样说来，用</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">还是不用。。。是个问题。也许真正能让人下定决心在项目中使用</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">boost::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的时候，就是在下一代</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">标准中其变成了</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">std::asio</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的时候吧</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">^^</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: large;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: large;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">九天雁翎</span></span></strong><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: large; font-family: Calibri;">&nbsp;</span></span></p>
