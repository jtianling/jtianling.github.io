---
layout: post
title: UCS-2与UTF8之间的选择（4）--linux中各编码字符串的C/C++输出支持及方式比较
categories:
- "网络技术"
tags:
- C++
- Linux
status: publish
type: post
published: true
meta:
  ratings_users: '0'
  ratings_score: '0'
  ratings_average: '0'
  views: '8'
author:
  login: jtianling
  email: jtianling@gmail.com
  display_name: jtianling
  first_name: ''
  last_name: ''
---
<br />
<h1 style="margin: 24pt 0cm 0pt;"><span style="color: #365f91;"><span class="title"><span lang="EN-US"><span style="font-family: Cambria;">UCS-2</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">与</span><span lang="EN-US"><span style="font-family: Cambria;">UTF8</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">之间的选择（</span><span lang="EN-US"><span style="font-family: Cambria;">4</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">）</span><span lang="EN-US"><span style="font-family: Cambria;">--linux</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">中各编码字符串的</span><span lang="EN-US"><span style="font-family: Cambria;">C/C++</span></span></span><span class="title"><span style="font-family: 宋体; mso-ascii-font-family: Cambria; mso-ascii-theme-font: major-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: major-fareast; mso-hansi-font-family: Cambria; mso-hansi-theme-font: major-latin;">输出支持及方式比较</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps;">九天雁翎</span><span style="letter-spacing: 0.25pt; font-variant: small-caps;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><strong><span style="text-decoration: underline;"><span style="color: #c0504d; letter-spacing: 0.25pt; font-variant: small-caps; mso-themecolor: accent2; mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></strong></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US"><span style="font-size: small;">讨论新闻组及文件</span></span></span></strong></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">继续研究</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">UTF8</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">和</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">UCS-2</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的选择，这里继续使用上一次提到的函数。</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">鉴于大家不一定能找到下载的地址，而源文件是允许自由散发的，我将代码打包，提供给大家下载，下载地址还是在</span><span lang="EN-US"><a href="http://groups.google.com/group/jiutianfile/"><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">讨论新闻组及文件</span></span></strong></a></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中，名字为</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">unicodeorg.rar</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">，</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">昨天看了下</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下的方法，这次研究</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Linux</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下的：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style='color: #804040; font-family: "Courier New";' lang="EN-US">&nbsp;1 </span><span style='color: #a020f0; font-family: "Courier New";' lang="EN-US">#include </span><span style='color: fuchsia; font-family: "Courier New";' lang="EN-US">&lt;stdio.h&gt;</span></span><span style='font-family: "Courier New";' lang="EN-US"><br /><span style="font-size: small;"><span style="color: #804040;">&nbsp;2 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">&lt;locale.h&gt;</span><br /><span style="color: #804040;">&nbsp;3 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">&lt;stdlib.h&gt;</span><br /><span style="color: #804040;">&nbsp;4 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">"ConvertUTF.h"</span><br /><span style="color: #804040;">&nbsp;5 </span><br /><span style="color: #804040;">&nbsp;6 </span><strong><span style="color: seagreen;">int</span></strong>&nbsp;main(<strong><span style="color: seagreen;">int</span></strong>&nbsp;argc, <strong><span style="color: seagreen;">char</span></strong>* argv[])<br /><span style="color: #804040;">&nbsp;7 </span>{<br /><span style="color: #804040;">&nbsp;8 </span><br /><span style="color: #804040;">&nbsp;9 </span>&nbsp;&nbsp;&nbsp;&nbsp;ConversionResult result = sourceIllegal;<br /><span style="color: #804040;">10 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF16 utf16_buf[<span style="color: fuchsia;">3</span>] = {<span style="color: fuchsia;">0</span>};<br /><span style="color: #804040;">11 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">0</span>] = <span style="color: fuchsia;">0x4e2d</span>;<br /><span style="color: #804040;">12 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">1</span>] = <span style="color: fuchsia;">0x6587</span>;<br /><span style="color: #804040;">13 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">2</span>] = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">14 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF16 *utf16Start = utf16_buf;<br /><span style="color: #804040;">15 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8 utf8_buf[<span style="color: fuchsia;">12</span>] = {<span style="color: fuchsia;">0</span>};<br /><span style="color: #804040;">16 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8* utf8Start = utf8_buf;<br /><span style="color: #804040;">17 </span><br /><span style="color: #804040;">18 </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">// If you want to test next line, you can't get anything but ???</span><br /><span style="color: #804040;">19 </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">// wprintf("%s/n", utf16_buf);</span><br /><span style="color: #804040;">20 </span><br /><span style="color: #804040;">21 </span>&nbsp;&nbsp;&nbsp;&nbsp;result = ConvertUTF16toUTF8((<strong><span style="color: seagreen;">const</span></strong>&nbsp;UTF16 **) &amp;utf16Start, &amp;(utf16_buf[<span style="color: fuchsia;">3</span>]), &amp;utf8Start, &amp;(utf8_buf[<span style="color: fuchsia;">12</span>]), strictConversion);<br /><span style="color: #804040;">22 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">switch</span></strong>&nbsp;(result) {<br /><span style="color: #804040;">23 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">default</span></strong>:&nbsp;fprintf(<span style="color: fuchsia;">stderr</span>, <span style="color: fuchsia;">"Test02B fatal error: result </span><span style="color: slateblue;">%d</span><span style="color: fuchsia;">&nbsp;for input </span><span style="color: slateblue;">%08x/n</span><span style="color: fuchsia;">"</span>, result, utf16_buf[<span style="color: fuchsia;">0</span>]); exit(<span style="color: fuchsia;">1</span>);<br /><span style="color: #804040;">24 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;conversionOK: <strong><span style="color: #804040;">break</span></strong>;<br /><span style="color: #804040;">25 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceExhausted: printf(<span style="color: fuchsia;">"sourceExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">26 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;targetExhausted: printf(<span style="color: fuchsia;">"targetExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">27 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceIllegal: printf(<span style="color: fuchsia;">"sourceIllegal</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">28 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">29 </span><br /><span style="color: #804040;">30 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: seagreen;">int</span></strong>&nbsp;i = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">31 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">for</span></strong>(; i &lt; <span style="color: fuchsia;">12</span>; ++i)<br /><span style="color: #804040;">32 </span>&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="color: #804040;">33 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">%x</span><span style="color: fuchsia;">&nbsp;"</span>, utf8_buf[i]);<br /><span style="color: #804040;">34 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">35 </span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color: #804040;">36 </span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">/n</span><span style="color: fuchsia;">"</span>);<br /><span style="color: #804040;">37 </span><br /><span style="color: #804040;">38 </span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">%s/n</span><span style="color: fuchsia;">"</span>, (<strong><span style="color: seagreen;">char</span></strong>*)utf8_buf);<br /><span style="color: #804040;">39 </span>&nbsp;&nbsp;&nbsp;&nbsp;bzero(utf16_buf, <strong><span style="color: #804040;">sizeof</span></strong>(utf16_buf));<br /><span style="color: #804040;">40 </span><br /><span style="color: #804040;">41 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8* utf8End = utf8Start;<br /><span style="color: #804040;">42 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf8Start = utf8_buf;<br /><span style="color: #804040;">43 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16Start = utf16_buf;<br /><span style="color: #804040;">44 </span><br /><span style="color: #804040;">45 </span>&nbsp;&nbsp;&nbsp;&nbsp;result = ConvertUTF8toUTF16((<strong><span style="color: seagreen;">const</span></strong>&nbsp;UTF8 **) &amp;utf8Start, utf8End, &amp;utf16Start, &amp;(utf16_buf[<span style="color: fuchsia;">3</span>]), strictConversion);<br /><span style="color: #804040;">46 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">switch</span></strong>&nbsp;(result) {<br /><span style="color: #804040;">47 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">default</span></strong>:&nbsp;fprintf(<span style="color: fuchsia;">stderr</span>, <span style="color: fuchsia;">"Test02B fatal error: result </span><span style="color: slateblue;">%d</span><span style="color: fuchsia;">&nbsp;for input </span><span style="color: slateblue;">%08x/n</span><span style="color: fuchsia;">"</span>, result, utf16_buf[<span style="color: fuchsia;">0</span>]); exit(<span style="color: fuchsia;">1</span>);<br /><span style="color: #804040;">48 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;conversionOK: <strong><span style="color: #804040;">break</span></strong>;<br /><span style="color: #804040;">49 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceExhausted: printf(<span style="color: fuchsia;">"sourceExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">50 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;targetExhausted: printf(<span style="color: fuchsia;">"targetExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">51 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceIllegal: printf(<span style="color: fuchsia;">"sourceIllegal</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">52 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">53 </span><br /><span style="color: #804040;">54 </span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">// If you want to test next line, you can't get anything</span><br /><span style="color: #804040;">55 </span>&nbsp;&nbsp;&nbsp;&nbsp;wprintf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">%s/n</span><span style="color: fuchsia;">"</span>, utf16_buf);<br /><span style="color: #804040;">56 </span><br /><span style="color: #804040;">57 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">return</span></strong>&nbsp;<span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">58 </span>}<br /><span style="color: #804040;">59</span></span></span><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">运行结果：</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">e4 b8 ad e6 96 87 0 0 0 0 0 0</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中文</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">这里和</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中不同的就是输出</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">UTF-8</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的字符串在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Linux</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下甚至不需要通过</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">setlocale</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">设置环境变量，这样对于</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的输出估计还是有好处的：），起码不会去影响到</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">C++</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的正常输出。但是，对于宽字节的输出没有办法成功，就算你像在</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Windows</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中设置</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">locale</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">也没有用，道理也很简单，因为</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">Linux</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">下的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">locale</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">我就是设置成</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">UTF-8</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">的</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-family: Calibri;">-_-!</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style='color: #804040; font-family: "Courier New";' lang="EN-US">&nbsp;1 </span><span style='color: #a020f0; font-family: "Courier New";' lang="EN-US">#include </span><span style='color: fuchsia; font-family: "Courier New";' lang="EN-US">&lt;stdio.h&gt;</span></span><span style='font-family: "Courier New";' lang="EN-US"><br /><span style="font-size: small;"><span style="color: #804040;">&nbsp;2 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">&lt;locale.h&gt;</span><br /><span style="color: #804040;">&nbsp;3 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">&lt;stdlib.h&gt;</span><br /><span style="color: #804040;">&nbsp;4 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">&lt;iostream&gt;</span><br /><span style="color: #804040;">&nbsp;5 </span><span style="color: #a020f0;">#include </span><span style="color: fuchsia;">"ConvertUTF.h"</span><br /><span style="color: #804040;">&nbsp;6 <strong>using</strong></span>&nbsp;<strong><span style="color: seagreen;">namespace</span></strong>&nbsp;std;<br /><span style="color: #804040;">&nbsp;7 </span><br /><span style="color: #804040;">&nbsp;8 </span><strong><span style="color: seagreen;">int</span></strong>&nbsp;main(<strong><span style="color: seagreen;">int</span></strong>&nbsp;argc, <strong><span style="color: seagreen;">char</span></strong>* argv[])<br /><span style="color: #804040;">&nbsp;9 </span>{<br /><span style="color: #804040;">10 </span>&nbsp;&nbsp;&nbsp;&nbsp;ConversionResult result = sourceIllegal;<br /><span style="color: #804040;">11 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF16 utf16_buf[<span style="color: fuchsia;">3</span>] = {<span style="color: fuchsia;">0</span>};<br /><span style="color: #804040;">12 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">0</span>] = <span style="color: fuchsia;">0x4e2d</span>;<br /><span style="color: #804040;">13 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">1</span>] = <span style="color: fuchsia;">0x6587</span>;<br /><span style="color: #804040;">14 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16_buf[<span style="color: fuchsia;">2</span>] = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">15 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF16 *utf16Start = utf16_buf;<br /><span style="color: #804040;">16 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8 utf8_buf[<span style="color: fuchsia;">12</span>] = {<span style="color: fuchsia;">0</span>};<br /><span style="color: #804040;">17 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8* utf8Start = utf8_buf;<br /><span style="color: #804040;">18 </span><br /><span style="color: #804040;">19 </span>&nbsp;&nbsp;&nbsp;&nbsp;result = ConvertUTF16toUTF8((<strong><span style="color: seagreen;">const</span></strong>&nbsp;UTF16 **) &amp;utf16Start, &amp;(utf16_buf[<span style="color: fuchsia;">3</span>]), &amp;utf8Start, &amp;(utf8_buf[<span style="color: fuchsia;">12</span>]), strictConversion);<br /><span style="color: #804040;">20 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">switch</span></strong>&nbsp;(result) {<br /><span style="color: #804040;">21 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">default</span></strong>:&nbsp;fprintf(<span style="color: fuchsia;">stderr</span>, <span style="color: fuchsia;">"Test02B fatal error: result </span><span style="color: slateblue;">%d</span><span style="color: fuchsia;">&nbsp;for input </span><span style="color: slateblue;">%08x/n</span><span style="color: fuchsia;">"</span>, result, utf16_buf[<span style="color: fuchsia;">0</span>]); exit(<span style="color: fuchsia;">1</span>);<br /><span style="color: #804040;">22 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;conversionOK: <strong><span style="color: #804040;">break</span></strong>;<br /><span style="color: #804040;">23 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceExhausted: printf(<span style="color: fuchsia;">"sourceExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">24 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;targetExhausted: printf(<span style="color: fuchsia;">"targetExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">25 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceIllegal: printf(<span style="color: fuchsia;">"sourceIllegal</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">26 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">27 </span><br /><span style="color: #804040;">28 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: seagreen;">int</span></strong>&nbsp;i = <span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">29 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">for</span></strong>(; i &lt; <span style="color: fuchsia;">12</span>; ++i)<br /><span style="color: #804040;">30 </span>&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="color: #804040;">31 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">%x</span><span style="color: fuchsia;">&nbsp;"</span>, utf8_buf[i]);<br /><span style="color: #804040;">32 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">33 </span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color: #804040;">34 </span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span style="color: fuchsia;">"</span><span style="color: slateblue;">/n</span><span style="color: fuchsia;">"</span>);<br /><span style="color: #804040;">35 </span><br /><span style="color: #804040;">36 </span>&nbsp;&nbsp;&nbsp;&nbsp;cout &lt;&lt; (<strong><span style="color: seagreen;">char</span></strong>*)utf8_buf &lt;&lt;endl;<br /><span style="color: #804040;">37 </span>&nbsp;&nbsp;&nbsp;&nbsp;bzero(utf16_buf, <strong><span style="color: #804040;">sizeof</span></strong>(utf16_buf));<br /><span style="color: #804040;">38 </span><br /><span style="color: #804040;">39 </span>&nbsp;&nbsp;&nbsp;&nbsp;UTF8* utf8End = utf8Start;<br /><span style="color: #804040;">40 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf8Start = utf8_buf;<br /><span style="color: #804040;">41 </span>&nbsp;&nbsp;&nbsp;&nbsp;utf16Start = utf16_buf;<br /><span style="color: #804040;">42 </span><br /><span style="color: #804040;">43 </span>&nbsp;&nbsp;&nbsp;&nbsp;result = ConvertUTF8toUTF16((<strong><span style="color: seagreen;">const</span></strong>&nbsp;UTF8 **) &amp;utf8Start, utf8End, &amp;utf16Start, &amp;(utf16_buf[<span style="color: fuchsia;">3</span>]), strictConversion);<br /><span style="color: #804040;">44 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">switch</span></strong>&nbsp;(result) {<br /><span style="color: #804040;">45 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">default</span></strong>:&nbsp;fprintf(<span style="color: fuchsia;">stderr</span>, <span style="color: fuchsia;">"Test02B fatal error: result </span><span style="color: slateblue;">%d</span><span style="color: fuchsia;">&nbsp;for input </span><span style="color: slateblue;">%08x/n</span><span style="color: fuchsia;">"</span>, result, utf16_buf[<span style="color: fuchsia;">0</span>]); exit(<span style="color: fuchsia;">1</span>);<br /><span style="color: #804040;">46 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;conversionOK: <strong><span style="color: #804040;">break</span></strong>;<br /><span style="color: #804040;">47 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceExhausted: printf(<span style="color: fuchsia;">"sourceExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">48 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;targetExhausted: printf(<span style="color: fuchsia;">"targetExhausted</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">49 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">case</span></strong>&nbsp;sourceIllegal: printf(<span style="color: fuchsia;">"sourceIllegal</span><span style="color: slateblue;">/t</span><span style="color: fuchsia;">"</span>); exit(<span style="color: fuchsia;">0</span>);<br /><span style="color: #804040;">50 </span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span style="color: #804040;">51 </span><br /><span style="color: #804040;">52 </span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: #804040;">return</span></strong>&nbsp;<span style="color: fuchsia;">0</span>;<br /><span style="color: #804040;">53 </span>}<br /><span style="color: #804040;">54</span></span></span><span style='color: #804040; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style='color: #804040; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-size: small;"><span style="color: #804040; font-family: 宋体; mso-ascii-font-family: 'Courier New'; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-fareast-language: ZH-CN; mso-bidi-font-family: 'Courier New';">直接可以获得</span><span style='color: #804040; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small;"><span style="font-family: Calibri;">e4 b8 ad e6 96 87 0 0 0 0 0 0</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="font-size: small;"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; mso-fareast-language: ZH-CN;">中文</span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">的输出，也不需要调用<span lang="EN-US">C++</span>的<span lang="EN-US">locale(imbue)</span>函数去改变流的状态，甚至可以说，使用了<span lang="EN-US">UTF-8</span>不仅仅是对<span lang="EN-US">ASCII</span>完全的兼容了，对于新添加的字符也是可以不改变任何代码就做到兼容的，这点给我印象深刻。难怪<span lang="EN-US">UTF-8</span>虽然是变长的编码方式，但是还是获得了这么广范围的应用。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">这样的情况下，在<span lang="EN-US">Linux</span>下同时在<span lang="EN-US">C </span>和<span lang="EN-US"> C++</span>中使用<span lang="EN-US">UTF-8</span>输出中文也不会有任何冲突，这个优势比在<span lang="EN-US">Windows</span>下大多了。<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;"><span style="font-size: small;">另外，有个很重要的问题需要提及的就是，目前我使用的<span lang="EN-US">Ubuntu8.04</span>桌面版，不支持全<span lang="EN-US">Unicode</span>的编码，似乎中文是没有什么问题，但是以前那几个太玄经的字符是输出不了的，可能其<span lang="EN-US">Unicode</span>的支持只到到<span lang="EN-US">BMP</span>这一层，这点比<span lang="EN-US">Windows</span>稍逊色。以前测试过，的确是输出不了，但是源代码已经被覆盖了，大家可以自己去确定一下：）<span lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: normal; mso-pagination: none; mso-layout-grid-align: none;"><span style="font-family: 新宋体; mso-hansi-font-family: 'Times New Roman'; mso-fareast-language: ZH-CN; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: 'Times New Roman'; mso-bidi-language: AR-SA; mso-no-proof: yes;" lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style='color: #a020f0; font-family: "Courier New"; mso-fareast-language: ZH-CN;' lang="EN-US"><span style="font-size: small;">&nbsp;</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt; text-align: right;" align="right"><span lang="EN-US"><a href="http://www.jtianling.com"><span style="font-size: small;"><span style="color: #800080;"><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">write by </span></span></strong><strong><span style="font-family: 宋体; letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;" lang="EN-US"><span lang="EN-US">九天雁翎</span></span></strong><strong><span style="letter-spacing: 0.25pt; font-variant: small-caps; mso-fareast-language: ZH-CN;"><span style="font-family: Calibri;">(JTianLing) -- www.jtianling.com</span></span></strong></span></span></a></span><span style="mso-fareast-language: ZH-CN;" lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 10pt;"><span style="mso-fareast-language: ZH-CN;" lang="EN-US"><span style="font-size: small; font-family: Calibri;">&nbsp;</span></span></p>
